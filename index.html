<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMC TDA ÊïôÂ≠∏Ë®≠Ë®àËºîÂä©Â∑•ÂÖ∑ÊèêË©ûÂô® (Teaching Design Aids Prompt Builder)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- DOCX Library for Word Export -->
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Orbitron:wght@400;500;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* --- Cyber Theme Styles --- */
        body.theme-cyber {
            background-color: #020617; /* Slate 950 */
            color: #e2e8f0; /* Slate 200 */
        }

        /* Cyber Grid Background */
        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 200vw;
            height: 200vh;
            background-image: 
                linear-gradient(rgba(6, 182, 212, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
            animation: grid-move 20s linear infinite;
            z-index: -1;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        body.theme-cyber .cyber-grid {
            opacity: 1;
        }

        @keyframes grid-move {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); }
        }

        /* Vignette Effect */
        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 50%, #020617 100%);
            z-index: -1;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        body.theme-cyber .vignette {
            opacity: 1;
        }

        /* Scrollbar - Conditional styling via CSS variables or specific overrides */
        body.theme-cyber textarea::-webkit-scrollbar-track { background: #0f172a; border-radius: 4px; }
        body.theme-cyber textarea::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; border: 1px solid #06b6d4; }
        body.theme-cyber textarea::-webkit-scrollbar-thumb:hover { background: #06b6d4; }

        body.theme-plain textarea::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
        body.theme-plain textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        body.theme-plain textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        textarea::-webkit-scrollbar { width: 8px; }

        /* Holographic Gradient Animation */
        @keyframes gradient-xy {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animate-holo {
            background-size: 200% 200%;
            animation: gradient-xy 3s ease infinite;
        }

        /* Text Glows - Only in Cyber Mode */
        body.theme-cyber .text-glow-cyan {
            text-shadow: 0 0 5px rgba(6, 182, 212, 0.5), 0 0 10px rgba(6, 182, 212, 0.3);
        }
        body.theme-cyber .text-glow-purple {
            text-shadow: 0 0 5px rgba(168, 85, 247, 0.5), 0 0 10px rgba(168, 85, 247, 0.3);
        }

        /* Tech Borders - Cyber Mode */
        .tech-border {
            position: relative;
            background: rgba(15, 23, 42, 0.6); 
            border: 1px solid rgba(6, 182, 212, 0.3); 
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        /* Tech Input - Cyber Mode */
        .tech-input {
            background: rgba(30, 41, 59, 0.5); 
            border: 1px solid #334155;
            color: #ecfeff;
            transition: all 0.3s ease;
        }
        .tech-input:focus {
            border-color: #06b6d4;
            box-shadow: 0 0 8px rgba(6, 182, 212, 0.4);
            background: rgba(30, 41, 59, 0.8);
        }

        /* --- Plain Theme Styles --- */
        body.theme-plain {
            background-color: #f8fafc; /* Slate 50 */
            color: #1e293b; /* Slate 800 */
        }

        .plain-border {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .plain-input {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            color: #334155;
            transition: all 0.3s ease;
        }
        .plain-input:focus {
            border-color: #3b82f6; /* Blue 500 */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            outline: none;
        }

        .orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        .mono {
            font-family: 'Share Tech Mono', monospace;
        }
    </style>
</head>
<body class="selection:bg-cyan-500 selection:text-white transition-colors duration-500">
    <!-- Background Elements (Only visible in Cyber theme) -->
    <div class="cyber-grid"></div>
    <div class="vignette"></div>
    
    <div id="root"></div>

    <!-- React Application Script -->
    <script type="text/babel" data-type="module">
        // FIX: Explicitly defined dependencies to ensure a singleton React instance
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { motion, AnimatePresence } from 'https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0,react-dom@18.2.0';
        import { 
            BookOpen, 
            Gamepad2, 
            HeartHandshake, 
            MessageCircle, 
            FlaskConical, 
            ChevronRight, 
            ChevronLeft, 
            Copy, 
            CheckCircle, 
            Wand2, 
            Settings2, 
            UserCircle, 
            Sparkles, 
            Save, 
            RotateCcw,
            Plus,
            Trash2,
            Monitor,
            Bot,
            Cpu, 
            Zap,  
            Accessibility,
            ExternalLink,
            Sun,
            Moon,
            Github,
            FileJson, 
            FileText,
            Upload 
        } from 'https://esm.sh/lucide-react@0.292.0?deps=react@18.2.0';

        // --- Components ---

        const Card = ({ children, className = "", theme }) => (
            <div className={`rounded-2xl overflow-hidden ${theme === 'cyber' ? 'tech-border' : 'plain-border'} ${className}`}>
                {children}
            </div>
        );

        const Label = ({ children, theme }) => (
            <label className={`block text-sm font-bold mb-2 flex items-center gap-2 ${
                theme === 'cyber' 
                ? 'text-cyan-300 tracking-wide uppercase orbitron' 
                : 'text-slate-700 tracking-normal'
            }`}>
                <span className={`w-1 h-4 rounded-sm inline-block ${theme === 'cyber' ? 'bg-cyan-500' : 'bg-blue-600'}`}></span>
                {children}
            </label>
        );

        const Input = (props) => {
            const { theme, className, ...rest } = props;
            return (
                <input 
                    className={`w-full px-4 py-3 rounded-xl outline-none ${theme === 'cyber' ? 'tech-input' : 'plain-input'} ${className || ""}`}
                    {...rest} 
                />
            );
        };

        const TextArea = (props) => {
            const { theme, className, ...rest } = props;
            return (
                <textarea 
                    className={`w-full px-4 py-3 rounded-xl outline-none min-h-[120px] ${theme === 'cyber' ? 'tech-input' : 'plain-input'} ${className || ""}`}
                    {...rest} 
                />
            );
        };

        const Select = ({ options, value, onChange, className = "", theme }) => (
            <div className={`relative ${className}`}>
                <select 
                    value={value}
                    onChange={onChange}
                    className={`w-full px-4 py-3 rounded-xl outline-none appearance-none cursor-pointer ${theme === 'cyber' ? 'tech-input' : 'plain-input'}`}
                >
                    {options.map(opt => (
                        <option 
                            key={opt.value} 
                            value={opt.value} 
                            className={theme === 'cyber' ? "bg-slate-900 text-slate-200" : "bg-white text-slate-800"}
                        >
                            {opt.label}
                        </option>
                    ))}
                </select>
                <div className={`absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none ${theme === 'cyber' ? 'text-cyan-500' : 'text-slate-400'}`}>
                    <ChevronRight size={16} className="rotate-90" />
                </div>
            </div>
        );

        // --- Main Application ---

        // Function to return fresh initial state
        const getInitialFormData = () => ({
            teacherName: "",
            toolName: "",
            category: "ÊïôÂ≠∏ÈÅäÊà≤", 
            subjectCategory: "Ë™ûÊñá", 
            subjectCustomInput: "", 
            gameStyle: ["Êâ≠ËõãÊ©ü (Gachapon)"], 
            gameStyleCustomInput: "", 
            interactionType: ["3ÈÅ∏1Á≠îÊ°à"], 
            interactionCustomInput: "", 
            learningDiversity: [], 
            includePreferenceSettings: true, // Default to true
            examples: [
                { text: "", level: "ÂàùÈöé", count: 10, mechanism: "3ÈÅ∏1Á≠îÊ°à" },
                { text: "", level: "‰∏≠Èöé", count: 10, mechanism: "4ÈÅ∏1Á≠îÊ°à" },
                { text: "", level: "È´òÈöé", count: 10, mechanism: "Ëº∏ÂÖ•ÊñáÂ≠ó (Text Input)" } 
            ],
            grade: "Â∞èÂ≠∏‰∫åÂπ¥Á¥ö (P2)",
            senLevel: "ËºïÂ∫¶ (Mild)",
            purpose: "",
            context: "",
            value: ["Â†ÖÊØÖ"], 
            rules: [`Ë®àÂàÜË¶èÂâáÔºöÂä™ÂäõÁçéÂãµÂûãË®àÂàÜË¶èÂâáÔºö
ÊØèÁ≠îÂ∞ç 1 È°åÂæó 10 ÂàÜÔºàËÇØÂÆöÂ≠∏ÁøíÊàêÊûúÔºâÔºå
ÊØèÁ≠îÈåØ 1 Ê¨°È°çÂ§ñÂä† 1 ÂàÜÔºàËÇØÂÆöÂãáÊñºÂòóË©¶Ôºâ„ÄÇ
Á∏ΩÂàÜÔºùÁ≠îÂ∞çÂæóÂàÜÔºãÈåØË™§Ê¨°Êï∏Ôºå
ËÆì„ÄåÂ†ÖÊåÅÂà∞Â∫ï„ÄçÁöÑÂä™Âäõ‰πüË¢´ÁúãË¶ãÔºÅ
Ëàâ‰æãÔºö2 È°åÂÖ®Â∞çÔºå‰ΩÜÂÖ±ÈåØ 6 Ê¨° ‚Üí ÂæóÂàÜÔºù20Ôºã6Ôºù26 ÂàÜ„ÄÇÂ≠∏ÁîüÁöÑÂ†±ÂëäÁúãÂà∞Ôºö
üéâ ÊÅ≠Âñú‰Ω†ÂÖ®ÈÉ®Á≠îÂ∞çÔºÅ
ËÉΩÂäõÂæóÂàÜÔºö20 ÂàÜ
Âä™ÂäõÂòóË©¶Ôºö6 Ê¨°
Á∏ΩÊàêÂ∞±ÂàÜÔºö26 ÂàÜ`, "Á≠îÂ∞çÊôÇÁµ¶‰∫à ÊèêÁ§∫Èü≥ÂèäÂ∞çÊáâÁöÑÁü•Ë≠òÁêÜË´ñÔºåÁÇ∫‰ΩïË©≤Á≠îÊ°àÊòØÊ≠£Á¢∫", "È¶ñÈ†ÅËº∏ÂÖ•Ê°ÜÊèêÁ§∫ÔºöË´ãËº∏ÂÖ•‰Ω†ÁöÑÂêçÂ≠óÈñãÂßãÈÅäÊà≤Ôºö ‰æãÂ¶ÇÔºöÂ∞èÊòé, Ë°åÂãïÊåâÈàïÔºöÈñãÂßãÈÅäÊà≤",
"Â¢ûÂä†‰∏ÄÂÄã Ëá™Â≠∏Ê®°ÂºèÔºåÁî®Êà∂ËÉΩËá™Ë°åË®≠ÂÆöÂïèÈ°åÁµ¶Ëá™Â∑±, ‰æãÂ≠ê(x - y) ÁÑ∂ÂæåËá™Ë°åËß£Á≠î„ÄÇ",
`„ÄåÂÄãÂà•ÂåñÂ≠∏ÁøíÂ†±ÂëäÈ†ÅÈù¢„ÄçÔºåÈúÄÁ¨¶Âêà‰ª•‰∏ãÂéüÂâáÔºö
a. ÂÄãÂà•ÂåñËàáÊï∏ÊìöÂåñ
È°ØÁ§∫ÂÖ∑È´îÂ≠∏ÁøíÊï∏ÊìöÔºå‰æãÂ¶ÇÔºöÁ≠îÂ∞çÈ°åÊï∏ÔºèÁ∏ΩÈ°åÊï∏„ÄÅÂπ≥ÂùáÂòóË©¶Ê¨°Êï∏„ÄÅÂÆåÊàêÊôÇÈñìÔºàËã•ÈÅ©Áî®Ôºâ
Ê®ôÁ§∫„ÄåÊúÄÁÜüÁ∑¥È†ÖÁõÆ„ÄçËàá„ÄåÈúÄÂä†Âº∑È†ÖÁõÆ„ÄçÔºà‰æãÂ¶ÇÔºöÊúÄÊòìÔºèÊúÄÈõ£ÁöÑÊï∏Â≠ó„ÄÅË©ûÂΩôÊàñÈ°åÂûãÔºâ
Êï∏ÊìöÈúÄÂü∫ÊñºÂ≠∏ÁîüÂØ¶Èöõ‰∫íÂãïË°åÁÇ∫ÔºàÂ¶ÇÈåØË™§Ê®°Âºè„ÄÅÈáçË©¶Ê¨°Êï∏ÔºâËÄåÈùûÂÉÖ‰∫åÂÖÉÂ∞çÈåØ
b. ÂèØË¶ñÂåñËàáÂÖíÁ´•ÂèãÂñÑË®≠Ë®à
‰ΩøÁî®Á∞°ÊòìÈï∑Ê¢ùÂúñ„ÄÅÂúìÈ§ÖÂúñÊàñÈÄ≤Â∫¶Ê¢ùÂëàÁèæÈóúÈçµÊï∏ÊìöÔºåÈÅøÂÖçË§áÈõúÂ∫ßÊ®ôËª∏
Êé°Áî®ÊüîÂíåÈÖçËâ≤„ÄÅÂ§ßÂ≠óÈ´î„ÄÅEmoji ÊàñÊèíÁï´È¢®Ê†ºÂúñÁ§∫ÔºàÂ¶Çüåü„ÄÅüí°„ÄÅüöÄÔºâ
ÈÅøÂÖçÊñáÂ≠óÂØÜÈõÜÔºåÂ§öÁî®ÂúñÁ§∫ËàáÁïôÁôΩÔºåÁ¢∫‰øù‰ΩéÂπ¥Á¥öÂ≠∏ÁîüËÉΩ‰∏ÄÁúºÁêÜËß£
c. Ê≠£ÂêëË™ûË®ÄËàáÂª∫Ë®≠ÊÄßÂª∫Ë≠∞
‰ª•ÊàêÈï∑ÂûãÊÄùÁ∂≠Ôºàgrowth mindsetÔºâÊé™Ëæ≠ÔºöÂº∑Ë™ø„ÄåÂä™Âäõ„Äç„ÄåÈÄ≤Ê≠•„Äç„ÄåÂ∞èÂ∞àÂÆ∂„Äç„ÄåÂÜçË©¶‰∏ÄÊ¨°Â∞±Êõ¥Âé≤ÂÆ≥„Äç
Êèê‰æõ 1‚Äì2 Ê¢ùÂÖ∑È´î„ÄÅÂèØÊìç‰ΩúÁöÑÂª∫Ë≠∞Ôºà‰æãÂ¶ÇÔºö„Äå‰Ω†ÂèØ‰ª•ÊØèÂ§©Á∑¥Áøí 3 Ê¨°„Äé7 ÁöÑÂàÜËß£„ÄèÔºåÂ∞±ÂÉèÊê≠Á©çÊú®‰∏ÄÊ®£ÔºÅ„ÄçÔºâ
ÈÅøÂÖçË≤†Èù¢Ê®ôÁ±§ÔºàÂ¶Ç„Äå‰Ω†‰∏çÊúÉ„Äç„ÄåÈåØË™§Â§™Â§ö„ÄçÔºâ`,
"üéâ ÊÖ∂Á•ùÁâπÊïà: ‰ªªÂãôÂÆåÊàêÊôÇËß∏Áôº canvas-confettiÔºàÁâπÊïàÂè™ÊúÉËß∏Áôº‰∏ÄÊ¨°ÔºåÈáçÁΩÆÂæåÊâçÊúÉÂÜçÊ¨°Ëß∏ÁôºÔºâ„ÄÇ"
            ]
        });

        function App() {
            const [step, setStep] = useState(1);
            const [copiedDesign, setCopiedDesign] = useState(false);
            const [copiedTech, setCopiedTech] = useState(false);
            const [theme, setTheme] = useState('cyber');
            const fileInputRef = useRef(null); // Ref for file input

            useEffect(() => {
                document.body.className = `theme-${theme}`;
            }, [theme]);
            
            // Initialize state using the generator function
            const [formData, setFormData] = useState(getInitialFormData());

            const toggleTheme = () => {
                setTheme(prev => prev === 'cyber' ? 'plain' : 'cyber');
            };

            // Toggle Preference Settings
            const togglePreferenceSettings = () => {
                setFormData(prev => ({
                    ...prev,
                    includePreferenceSettings: !prev.includePreferenceSettings
                }));
            };

            const categories = [
                { value: "ÊïôÂ≠∏Â∑•ÂÖ∑", label: "üìö ÊïôÂ≠∏Â∑•ÂÖ∑", icon: BookOpen },
                { value: "ÊïôÂ≠∏ÈÅäÊà≤", label: "üéÆ ÊïôÂ≠∏ÈÅäÊà≤", icon: Gamepad2 },
                { value: "ÊÉÖÁ∑íÊîØÊè¥", label: "‚ù§Ô∏è ÊÉÖÁ∑íÊîØÊè¥", icon: HeartHandshake },
                { value: "Ê∫ùÈÄöËºîÂä©", label: "üó£Ô∏è Ê∫ùÈÄöËºîÂä©", icon: MessageCircle },
                { value: "ÂØ¶È©óÊ®°Êì¨", label: "üß™ ÂØ¶È©óÊ®°Êì¨", icon: FlaskConical },
            ];

            const subjects = ["Ë™ûÊñá", "Êï∏Â≠∏", "Ëã±Êñá", "‰∫∫Êñá", "ÁßëÂ≠∏", "ÁîüÊ¥ªÊäÄËÉΩ", "ÈõªËÖ¶", "Áè≠‰∏ª‰ªªË™≤", "ÂÖ∂‰ªñ"];

            const gameStyles = [
                "Êâ≠ËõãÊ©ü (Gachapon)", 
                "Â§æÂÖ¨‰ªîÊ©ü (Claw Crane)", 
                "Candy Crush (Ê∂àÈô§È°û / Match-3)",
                "ËÄÅËôéÊ©ü (Slot Machine)", 
                "ËΩâÁõ§ÊäΩÁçé (Spin Wheel)", 
                "Â§ßÂØåÁøÅ / È™∞Â≠êÂâçÈÄ≤ (Board Game)", 
                "ÂØ∂ÁÆ± / Á•ûÁßòÁ¶ÆÁõí (Mystery Box)", 
                "Ê∞£ÁêÉÊà≥Á†¥ (Pop the Balloon)", 
                "ÊäïÂπ£Ë®±È°òÊ±† (Wishing Well)", 
                "ÊâìÂú∞Èº† (Whack-a-Mole)", 
                "Êé•Ê∞¥Êûú (Catching Fruit)", 
                "Á¶ÆÁâ©Áõí / ËÅñË™ïÊãÜÁ¶Æ (Gift Box)", 
                "È£≤ÊñôÊ©ü / Ëá™Âä©ÈªûÈ§êÊ©ü (Vending Machine)", 
                "ÊîæÂ§©Ááà / Â≠îÊòéÁáà (Sky Lantern)", 
                "Á•àÁ¶èÁâÜ / È°òÊúõÊùø (Wish Wall)", 
                "È¶ôÁàê / ÈªûÈ¶ôÁ•àÁ¶è (Incense Offering)", 
                "ÂÖ∂‰ªñ"
            ];
            
            const answerMechanismOptions = [
                 { value: "3ÈÅ∏1Á≠îÊ°à", label: "3ÈÅ∏1Á≠îÊ°à" },
                 { value: "4ÈÅ∏1Á≠îÊ°à", label: "4ÈÅ∏1Á≠îÊ°à" },
                 { value: "Â§öÈÅ∏È°å", label: "Â§öÈÅ∏È°å" },
                 { value: "Ëº∏ÂÖ•ÊñáÂ≠ó (Text Input)", label: "Ëº∏ÂÖ•ÊñáÂ≠ó (Text Input)" },
                 { value: "ÊâæË©ûÈÅäÊà≤ (Word Search Puzzle)", label: "ÊâæË©ûÈÅäÊà≤ (Word Search Puzzle)" },
                 { value: "ÂÖ∂‰ªñ", label: "ÂÖ∂‰ªñ" }
            ];

            const interactionTypes = [
                // Âü∫Á§éÈ°åÂûã REMOVED
                "ÊâæË©ûÈÅäÊà≤ (Word Search Puzzle)", 
                
                // Êìç‰ΩúËàáÊéíÂ∫è
                "ÈªûÊìä (Click)",
                "ÊãñÊãâÁâ©‰ª∂ (Drag & Drop)",
                "ÊãñÊãâÊéíÂ∫è (Drag & Drop Ordering)",
                "ÈÄ£Á∑öÈ°å (Connect the Dots)",
                "ÂúñË©ûÈÖçÂ∞ç (Matching)",
                "ÁøªÂç° / ÁøªÁâåË®òÊÜ∂ÈÖçÂ∞ç (Memory Flip Cards)",
                "ÊªëÊ°øË™øÁØÄ / Êï∏ÂÄºÊéßÂà∂ (Slider Control)",
                "ÊóãËΩâ / ÊîæÂ§ßÁâ©‰ª∂",
                
                // Ââµ‰ΩúËàáËóùË°ì
                "Áï´Â∏ÉÁπ™Âúñ / Ëá™Áî±Ââµ‰Ωú (Drawing Canvas)",
                "Â°´Ëâ≤ / ‰∏äËâ≤ (Coloring)",
                "ÊãºÂúñ / ÊãºÂêàÁ¢éÁâá (Jigsaw Puzzle)",
                "ËßíËâ≤ÊèõË£ù / ÊñáÂåñÊúçÈ£æË©¶Á©ø (Virtual Dress-Up)",
                
                // Ê®°Êì¨ËàáÊé¢Á¥¢
                "Áâ©ÁêÜÊ®°Êì¨ (Physics Simulation)",
                "Ê®°Êì¨Êìç‰Ωú (Simulation Control)",
                "Âú∞ÂúñÊé¢Á¥¢ / ÈªûÊìäÊé¢Á¥¢ (Map Exploration)",
                "Èö±ËóèÁâ©‰ª∂Â∞ãÊâæ (Hidden Object Game)",
                "ËßíËâ≤Ë£ùÂÇô / ÂçáÁ¥öÁ≥ªÁµ± (Inventory / Upgrade)",
                
                // Êïò‰∫ãËàáÊÉÖÂ¢É
                "ËßíËâ≤ÊâÆÊºî / Â∞çË©±ÈÅ∏Êìá (Branching Dialogue)",
                "ÊÉÖÂ¢ÉÈÅ∏Êìá ‚Üí ÂæåÊûúÂèçÈ•ã (Moral Dilemma)",
                "ËßíËâ≤Â∞çË©±Ëº™ÊµÅÊúóËÆÄ (Read-Aloud)",
                "ÊïÖ‰∫ãÊé•Èæç / ÂÖ±ÂâµÊñáÊú¨ (Collaborative Story)",
                
                // Â§öÊÑüÂÆòËàáÂÖ∂‰ªñ
                "ÊâãÂã¢ÊéßÂà∂ / ÊÑüÊáâÂô®‰∫íÂãï",
                "Èü≥È†ªËæ®Ë≠ò / ÈåÑÈü≥‰∫íÂãï",
                "Á§æ‰∫§‰∫íÂãï / ÂàÜ‰∫´ÊàêÂ∞±",
                "ÊôÇÈñìÈôêÂà∂ÊåëÊà∞",
                "ÂÖ∂‰ªñ"
            ];

            const learningDiversityOptions = [
                { label: "Á∞°ÂåñÂÖßÂÆπ (Simplify Content)", desc: "‰ΩøÁî®Á∞°ÂñÆË©ûÂΩô„ÄÅÁü≠Âè•ÔºåÈÅøÂÖçÂÜóÈï∑Ë™™ÊòéÔºõ‰∏ÄÊ¨°Âè™Êïô‰∏ÄÂÄãÊ¶ÇÂøµ„ÄÇ" },
                { label: "Â§öÊÑüÂÆòËº∏ÂÖ• (Multi-sensory)", desc: "ÁµêÂêàÂúñÁâá„ÄÅËÅ≤Èü≥„ÄÅÂãï‰Ωú„ÄÅËß∏Ë¶∫Á≠âÂ§öÁÆ°ÈÅìÂà∫ÊøÄÔºåÊèêÂçáÁêÜËß£ËàáË®òÊÜ∂„ÄÇ" },
                { label: "ÁµêÊßãÂåñËàáÈáçË§á (Structure & Repetition)", desc: "Êèê‰æõÊ∏ÖÊô∞Ê≠•È©ü„ÄÅÂõ∫ÂÆöÊµÅÁ®ãËàáÂèçË¶ÜÁ∑¥ÁøíÊ©üÊúÉ„ÄÇ" },
                { label: "Âç≥ÊôÇÂõûÈ•ãËàáÁçéÂãµ (Instant Feedback)", desc: "ÊØèÂÆåÊàê‰∏ÄÊ≠•Âç≥Áµ¶‰∫àËÇØÂÆöÔºàËÅ≤Èü≥„ÄÅÂãïÁï´„ÄÅË≤ºÁ¥ôÁ≠âÔºâÔºåÂ¢ûÂº∑ÂãïÊ©ü„ÄÇ" },
                { label: "Ë¶ñË¶∫ËºîÂä© (Visual Aids)", desc: "‰ΩøÁî®ÂúñÂç°„ÄÅÊµÅÁ®ãÂúñ„ÄÅÈ°èËâ≤ÂçÄÂàÜ„ÄÅÂ§ßÂ≠óÈ´î„ÄÅÈ´òÂ∞çÊØîÁïåÈù¢„ÄÇ" },
                { label: "ÁîüÊ¥ªÂåñÂÖßÂÆπ (Real-life Context)", desc: "ÊïôÂ≠∏ÈÄ£ÁµêÊó•Â∏∏ÁîüÊ¥ªÔºàÂ¶ÇË≥ºÁâ©„ÄÅ‰∫§ÈÄö„ÄÅË°õÁîüÔºâÔºåÊèêÂçáÂØ¶Áî®ÊÄß„ÄÇ" },
                { label: "Ë™ûÈü≥ÊúóËÆÄÈ°åÁõÆ (TTS Question - HK)", desc: "È°åÁõÆÊèê‰æõÂª£Êù±Ë©±Ë™ûÈü≥ÊúóËÆÄÂäüËÉΩ„ÄÇ" },
                { label: "Ë™ûÈü≥ÊúóËÆÄÁ≠îÊ°à (TTS Answer - HK)", desc: "Á≠îÊ°àÊèê‰æõÂª£Êù±Ë©±Ë™ûÈü≥ÊúóËÆÄÂäüËÉΩ„ÄÇ" },
                { label: "Ë¶ñË¶∫ÊèêÁ§∫ (Visual Cues)", desc: "Âä†ÂÖ•ÁÆ≠È†≠„ÄÅËâ≤Â°ä„ÄÅÈÄ≤Â∫¶Ê¢ùÁ≠âË¶ñË¶∫ÊèêÁ§∫„ÄÇ" }
            ];

            const values = [
                "Â†ÖÊØÖ", "Â∞äÈáç‰ªñ‰∫∫", "Ë≤¨‰ªªÊÑü", "ÂúãÊ∞ëË∫´‰ªΩË™çÂêå", "ÊâøÊìîÁ≤æÁ•û", 
                "Ë™†‰ø°", "‰ªÅÊÑõ", "ÂÆàÊ≥ï", "ÂêåÁêÜÂøÉ", "Âã§Âãû", "ÂúòÁµê", "Â≠ùË¶™"
            ];

            const grades = [
                "Â∞èÂ≠∏‰∏ÄÂπ¥Á¥ö (P1)", 
                "Â∞èÂ≠∏‰∫åÂπ¥Á¥ö (P2)", 
                "Â∞èÂ≠∏‰∏âÂπ¥Á¥ö (P3)", 
                "Â∞èÂ≠∏ÂõõÂπ¥Á¥ö (P4)", 
                "Â∞èÂ≠∏‰∫îÂπ¥Á¥ö (P5)", 
                "Â∞èÂ≠∏ÂÖ≠Âπ¥Á¥ö (P6)", 
                "‰∏≠Â≠∏‰∏ÄÂπ¥Á¥ö (S1)", 
                "‰∏≠Â≠∏‰∫åÂπ¥Á¥ö (S2)", 
                "‰∏≠Â≠∏‰∏âÂπ¥Á¥ö (S3)", 
                "‰∏≠Â≠∏ÂõõÂπ¥Á¥ö (S4)", 
                "‰∏≠Â≠∏‰∫îÂπ¥Á¥ö (S5)", 
                "‰∏≠Â≠∏ÂÖ≠Âπ¥Á¥ö (S6)"
            ];

            const difficultyLevels = [
                { value: "ÂàùÈöé", label: "ÂàùÈöé" },
                { value: "‰∏≠Èöé", label: "‰∏≠Èöé" },
                { value: "È´òÈöé", label: "È´òÈöé" }
            ];

            // Logic to handle Rule changes
            const handleRuleChange = (index, value) => {
                const newRules = [...formData.rules];
                newRules[index] = value;
                setFormData({ ...formData, rules: newRules });
            };

            const addRule = () => {
                setFormData({ ...formData, rules: [...formData.rules, ""] });
            };

            const removeRule = (index) => {
                const newRules = formData.rules.filter((_, i) => i !== index);
                setFormData({ ...formData, rules: newRules });
            };

            // Logic to handle Example changes
            const handleExampleChange = (index, field, value) => {
                const newExamples = [...formData.examples];
                newExamples[index] = { ...newExamples[index], [field]: value };
                setFormData({ ...formData, examples: newExamples });
            };

            const addExample = () => {
                setFormData({ ...formData, examples: [...formData.examples, { text: "", level: "ÂàùÈöé", count: 10, mechanism: "3ÈÅ∏1Á≠îÊ°à" }] });
            };

            const removeExample = (index) => {
                const newExamples = formData.examples.filter((_, i) => i !== index);
                setFormData({ ...formData, examples: newExamples });
            };

            // Generic Helper to toggle array selections
            const toggleSelection = (field, item) => {
                setFormData(prev => {
                    const current = prev[field];
                    if (current.includes(item)) {
                        return { ...prev, [field]: current.filter(t => t !== item) };
                    } else {
                        return { ...prev, [field]: [...current, item] };
                    }
                });
            };

            // Generate the Master Prompt
            const generateDesignPrompt = () => {
                const rulesList = formData.rules.filter(r => r.trim() !== "").map((r, i) => `${i + 1}. ${r}`).join("\n    ");
                const examplesList = formData.examples.filter(ex => ex.text.trim() !== "").map((ex, i) => `* [${ex.level}] (${ex.mechanism}) ${ex.text} (Ë´ãÁîüÊàê ${ex.count || 10} È°åËøë‰ººÈ°åÁõÆ)`).join("\n    ");
                const isGame = formData.category === "ÊïôÂ≠∏ÈÅäÊà≤";
                
                const subject = formData.subjectCategory === "ÂÖ∂‰ªñ" ? formData.subjectCustomInput : formData.subjectCategory;

                let styles = [...formData.gameStyle];
                if (styles.includes("ÂÖ∂‰ªñ")) {
                    styles = styles.filter(s => s !== "ÂÖ∂‰ªñ");
                    if (formData.gameStyleCustomInput.trim()) {
                        styles.push(formData.gameStyleCustomInput);
                    }
                }
                const style = styles.length > 0 ? styles.join("„ÄÅ") : "Êú™ÊåáÂÆö";
                
                // Interaction Logic
                let interactions = [...formData.interactionType];
                if (interactions.includes("ÂÖ∂‰ªñ")) {
                    interactions = interactions.filter(i => i !== "ÂÖ∂‰ªñ");
                    if (formData.interactionCustomInput.trim()) {
                        interactions.push(formData.interactionCustomInput);
                    }
                }
                const interaction = interactions.length > 0 ? interactions.join("„ÄÅ") : "Êú™ÊåáÂÆö";

                const diversityList = formData.learningDiversity.map(opt => {
                    const option = learningDiversityOptions.find(o => o.label === opt);
                    return `* **${opt}**Ôºö${option ? option.desc : ""}`;
                }).join("\n    ");

                const valuesStr = formData.value.length > 0 ? formData.value.join("„ÄÅ") : "ÁÑ°";
                
                let prompt = `# 1. ËßíËâ≤Ë®≠ÂÆö (Role)
‰Ω†ÊòØ‰∏Ä‰ΩçÊìÅÊúâ 15 Âπ¥Á∂ìÈ©óÁöÑ„ÄåË≥áÊ∑±ÂâçÁ´ØÂ∑•Á®ãÂ∏´„ÄçËàá„ÄåÊïôËÇ≤ÁßëÊäÄÔºàEdTechÔºâUX Â∞àÂÆ∂„ÄçÔºåÂ∞àÊ≥®ÊñºÁÇ∫Â∞èÂ≠∏ÁîüËá≥‰∏≠Â≠∏ÁîüÔºàÂÖ∑ÁâπÊÆäÊïôËÇ≤ÈúÄÊ±ÇÁöÑÂ≠∏ÁøíËÄÖÔºâË®≠Ë®àÁõ¥ËßÄ„ÄÅÈ´ò‰∫íÂãïÊÄß‰∏îÁ¨¶ÂêàÁÑ°ÈöúÁ§ôÊ®ôÊ∫ñÔºàWCAG 2.1ÔºâÁöÑÁ∂≤È†ÅÂ≠∏ÁøíÂ∑•ÂÖ∑„ÄÇ‰Ω†ÊìÖÈï∑‰ΩøÁî® HTML5„ÄÅCSS3 Ëàá Vanilla JavaScript ÈñãÁôºËºïÈáè„ÄÅÈüøÊáâÂºè„ÄÅÁÑ°ÈúÄÂ§ñÈÉ®‰æùË≥¥ÁöÑÊáâÁî®Ôºå‰∏¶ÂÅèÂ•ΩÈÅãÁî® Emoji„ÄÅCSS ÂãïÁï´„ÄÅÊ≠£ÂêëÂõûÈ•ãÊ©üÂà∂ ËàáÂ§öÊÑüÂÆòÊèêÁ§∫ÔºàÂ¶ÇÈ°èËâ≤„ÄÅËÅ≤Èü≥„ÄÅÈªûÊìäÂãïÊïàÔºâ‰æÜÊèêÂçáÂ≠∏ÁøíÂãïÊ©üËàáÂèÉËàáÂ∫¶„ÄÇ

‰Ω†ÁöÑ‰ªªÂãôÊòØÂçîÂä©ÊïôËÇ≤Â∑•‰ΩúËÄÖÔºàÂ¶ÇÊïôÂ∏´ÊàñË™≤Á®ãË®≠Ë®àËÄÖÔºâÊâìÈÄ†‰∏ÄÂÄãÂú®Ê°åÊ©üËàáË°åÂãïË£ùÁΩÆ‰∏äÁöÜÁõ¥ËßÄÊòìÁî®ÁöÑÁ∑ö‰∏äÂ≠∏ÁøíÂπ≥Âè∞„ÄÇË´ã‰ª•È°ßÂïèÂºèÂè£ÂêªÔºåÂÖ∑ÊâπÂà§ÊÄßÂèäÂª∫Ë®≠ÊÄßÊÄùËÄÉËßíÂ∫¶Ôºå‰∏çË¶ÅÁõ≤ÁõÆÊúçÂæûÔºåÊâæÂà∞Ë®≠Ë®àÁöÑÈÇèËºØÂïèÈ°å„ÄÅË®≠Ë®àÁõ≤ÈªûÔºåË´ãÁâπÂà•Âæû‰ª•‰∏ãËßíÂ∫¶ÈÄ≤Ë°åÊâπÂà§ÊÄßÊ™¢Ë¶ñÔºö
‚Ä¢„ÄåÊ™¢Ë¶ñ„ÄéÈÅäÊà≤ÔºçÂïèÁ≠î‰∫§ÊõøÂæ™Áí∞„ÄèÊ©üÂà∂ÊòØÂê¶ÈÇèËºØÊ∏ÖÊô∞
‚Ä¢Ê®°Êì¨Â∑•ÂÖ∑ÁöÑÊ©üÂà∂ÊòØÂê¶Áõ¥ËßÄÂÆπÊòìÊòéÁôΩÔºü
‚Ä¢Â≠∏ÁøíÂ∑•ÂÖ∑ÁöÑÊéíÊùøÊòØÂê¶ÊúâË™§?
‚Ä¢ Ë°åÂãïË£ùÁΩÆ‰∏äÁöÑ‰∫íÂãïÊ®°ÂºèÊòØÂê¶Á¨¶ÂêàÁÑ°ÈöúÁ§ôÊ®ôÊ∫ñÔºü

ÂàÜ‰ª•‰∏ãÂõõÈÉ®ÂàÜÂõûÊáâÔºö
‰∏Ä.  Ê†∏ÂøÉË®≠Ë®àÂéüÂâáÔºöË™™Êòé 3‚Äì4 È†ÖÈáùÂ∞ç‰∏ãÊñá
# 2. Â∞àÊ°àÂèÉÊï∏ÈÖçÁΩÆ (Configuration)
# 3. Ë®≠Ë®àËàáÊïôËÇ≤ÂéüÂâá (Design & Pedagogical Principles)
# 4. Êô∫ËÉΩÊïôÂ≠∏ÈÇèËºØ (AI Scaffolding Logic)
# 5. ÈÅäÊà≤ÂåñÁµêÁÆóÁ≥ªÁµ± (Game Over & Report)
ÁöÑÈóúÈçµ UX/UI ÂéüÂâá

‰∫å.  Áï´Èù¢ÁµêÊßãÂª∫Ë≠∞ÔºöÈáùÂ∞ç
# 2. Â∞àÊ°àÂèÉÊï∏ÈÖçÁΩÆ (Configuration)
# 3. Ë®≠Ë®àËàáÊïôËÇ≤ÂéüÂâá (Design & Pedagogical Principles)
# 4. Êô∫ËÉΩÊïôÂ≠∏ÈÇèËºØ (AI Scaffolding Logic)
# 5. ÈÅäÊà≤ÂåñÁµêÁÆóÁ≥ªÁµ± (Game Over & Report)
ÔºåÊèèËø∞ÂÖ∂ÈüøÊáâÂºè‰ΩàÂ±Ä„ÄÅÂ∞éËà™ÈÇèËºØËàáË¶ñË¶∫Â±§Á¥öÔºå‰∏¶Âº∑Ë™øÂ¶Ç‰ΩïÈÄèÈÅéÁïôÁôΩ„ÄÅÂ§ßÊåâÈàï„ÄÅÊüîÂíåÈÖçËâ≤ËàáÂ≠óÈ´îÈÅ∏ÊìáÊèêÂçáÂèØËÆÄÊÄßËàáËàíÈÅ©Â∫¶„ÄÇ

‰∏â.  ‰∫íÂãïÊ¥ªÂãïÁØÑ‰æãÔºö
Ê†πÊìö# 2. Â∞àÊ°àÂèÉÊï∏ÈÖçÁΩÆ (Configuration)
Êèê‰æõ 1‚Äì2 ÂÄãÂÖ∑È´î„ÄÅÂèØÁ´ãÂç≥ÂØ¶‰ΩúÁöÑ‰∫íÂãïÊ¥ªÂãïË®≠Ë®àÔºà‰æãÂ¶Ç„ÄåÊãñÊîæÂàÜÈ°û„ÄçÊàñ„ÄåÈªûÊìäÊ∂àÈô§Á≠îÈ°å„ÄçÔºâÔºåÁÑ°ÈöúÁ§ôËÄÉÈáèÔºàÂ¶ÇÈçµÁõ§Â∞éËà™ÊîØÊè¥Ôºâ„ÄÅ‰ª•ÂèäÂ¶Ç‰ΩïÂëàÁèæÊ≠£ÂêëÂõûÈ•ãÔºàÂ¶ÇÁ≠îÈåØ‰∏çÊá≤ÁΩ∞„ÄÅÂ§öÊ¨°ÂòóË©¶Âä†ÂàÜÁ≠âÊàêÈï∑ÂûãÊÄùÁ∂≠Ê©üÂà∂Ôºâ„ÄÇ

Âõõ„ÄÅÊèê‰æõ„ÄåÈ´ò‰øùÁúüÊñáÂ≠óÁâà‰ªãÈù¢ËóçÂúñ„ÄçÔºö
‰ª•ÁµêÊßãÂåñÊñáÂ≠óÔºàÊê≠ÈÖç Emoji„ÄÅÁ∏ÆÊéí„ÄÅÂçÄÂ°äÊ®ôÁ§∫ÔºâÊ®°Êì¨ÈóúÈçµÁï´Èù¢ÔºàÂ¶ÇÈÅäÊà≤‰∏ªÁï´Èù¢„ÄÅÁµêÁÆóÂ†±ÂëäÈ†ÅÔºâÁöÑ‰ΩàÂ±Ä„ÄÅÂÖÉ‰ª∂‰ΩçÁΩÆËàá‰∫íÂãïÁãÄÊÖãÔºå‰∏¶Ê®ôË®ªË®≠Ë®àÊÑèÂúñÔºàÂ¶Ç„ÄåÊ≠§Ëôï‰ΩøÁî®Â§ßÊåâÈàïÁ¢∫‰øùËß∏ÊéßÊ∫ñÁ¢∫ÊÄß„ÄçÔºâ„ÄÇ

****„Äå‰ª•‰∏ãÁÇ∫Â∞àÊ°àÈÖçÁΩÆÔºåË´ãÊìöÊ≠§ÂàÜÊûê„Äç

# 2. Â∞àÊ°àÂèÉÊï∏ÈÖçÁΩÆ (Configuration)
**Ë´ãÊ†πÊìö‰ª•‰∏ãË®≠ÂÆöÔºåÊßãÂª∫Á®ãÂºèÁöÑÈÇèËºØËàáÂÖßÂÆπÔºö**

* **Â∑•ÂÖ∑ÂêçÁ®±**Ôºö${formData.toolName || "[Êú™ÂëΩÂêçÂ∑•ÂÖ∑]"}
* **Â∑•ÂÖ∑ÁØÑÁñá**Ôºö${formData.category}
* **ÁßëÁõÆ**Ôºö${subject || "Êú™ÊåáÂÆö"}
${isGame ? `* **ÈÅäÊà≤È¢®Ê†º (Game Style)**Ôºö${style} (Ë´ã‰ª•Ê≠§È¢®Ê†º‰ΩúÁÇ∫‰∏ªË¶ÅÁöÑË¶ñË¶∫Èö±ÂñªËàá‰∫íÂãïÂåÖË£ù)
    * **ÈÅäÊà≤Ê©üÂà∂Ë™™Êòé**Ôºö„ÄåÈÅäÊà≤ÈöéÊÆµ„ÄçÔºöÁ¥îÁ≤πÈÅäÊà≤(ÁÑ°Áü•Ë≠òÔºâÔºåÂÉÖ‰ΩúÁÇ∫Â≠∏ÁøíÈñìÁöÑÂãïÊ©üË™øÁØÄÂô®ÔºåÊâÄÊúâÁü•Ë≠òÂÇ≥ÈÅûÂÉÖÁôºÁîüÊñºÂïèÁ≠îÂΩàÁ™ó„ÄÇ„ÄåÈÅäÊà≤ÔºçÂïèÁ≠î‰∫§ÊõøÂæ™Áí∞„ÄçÊ®°ÂºèÔºå ÈÄ≤Ë°åÈÅäÊà≤Ê©üÂà∂ÂæåÊúÉÂΩàÂá∫‰∏ÄÂÄãÂïèÈ°åÔºå ÁÑ°Ë´ñÁ≠îÂ∞çÊàñÁ≠îÈåØÔºåÁöÜÁµ¶‰∫àÂç≥ÊôÇÂõûÈ•ãÔºå‰∏¶ËøîÂõû‰∏ã‰∏ÄÂÄãÈóúÂç°ÔºåÊ≠§Âæ™Áí∞ÊåÅÁ∫åÈÄ≤Ë°åÔºåÁõ¥Âà∞ÂÆåÊàêÈ†êË®≠È°åÊï∏„ÄÇ` : ""}
* **‰∫íÂãïÊ©üÂà∂**Ôºö${interaction}
${isGame ? `* **ÈÅäÊà≤Ê®°ÂºèÈúÄÊ±Ç**ÔºöË´ãÁîüÊàê **‰∏âÁ®ÆÈÅäÊà≤Ê®°Âºè**ÔºåÊØèÁ®ÆÊ®°ÂºèÈúÄÂàÜÈñã **ÂàùÈöé„ÄÅ‰∏≠Èöé„ÄÅÈ´òÈöé** ‰∏âÁ®ÆÈõ£Â∫¶„ÄÇ` : ""}
${isGame && examplesList ? `* **ÁØÑ‰æãÈ°åÁõÆ (Example Questions)**Ôºö\n    ${examplesList}` : ""}
* **Ê†∏ÂøÉÁî®ÈÄî**Ôºö${formData.purpose || "Â∞öÊú™Â°´ÂØ´Áî®ÈÄî"}
* **ÁõÆÊ®ôÂ≠∏ÁîüÂπ¥Á¥ö**Ôºö${formData.grade}
* **ÊîØÊè¥ÈúÄÊ±Ç (SEN Support)**Ôºö${formData.senLevel}
    * *ÈÇèËºØË®≠ÂÆöÔºö„Äå‰∏≠Â∫¶„ÄçÈúÄÊõ¥Â§öË¶ñË¶∫ËºîÂä©„ÄÅÂ∞ëÂ≠óÂ§öÂúñ„ÄÅË©ûÂΩôÁ∞°ÂñÆÔºõ„ÄåËºïÂ∫¶„ÄçÂèØÂåÖÂê´ËºÉÂ§öÊñáÂ≠óË™™Êòé„ÄÇ*
* **ÁÖßÈ°ßÂ≠∏ÁøíÂ∑ÆÁï∞ (Learning Diversity Support)**Ôºö
    ${diversityList || "ÁÑ°ÁâπÊÆäË®≠ÂÆö"}
* **ÁîüÊ¥ªÊÉÖÂ¢ÉË®≠ÂÆö**Ôºö${formData.context || "‰∏ÄËà¨ÊïôÂÆ§ÊÉÖÂ¢É"}
* **ËûçÂÖ•ÂÉπÂÄºËßÄ**Ôºö${valuesStr}
* **ÂÖ∑È´îË¶èÂâáËàáÈÇèËºØ**Ôºö
    ${rulesList || "ÁÑ°ÁâπÊÆäË¶èÂâá"}

# 3. Ë®≠Ë®àËàáÊïôËÇ≤ÂéüÂâá (Design & Pedagogical Principles)
**Ë´ãÂö¥Ê†ºÈÅµÂÆà‰ª•‰∏ã 5 Â§ßÂéüÂâáÔºö**

1.  **üåà Ë¶ñË¶∫ÂèãÂñÑ (Visual Friendliness)**
    * **È¢®Ê†º**ÔºöÂèØÊÑõÂç°ÈÄö„ÄÅËâ≤ÂΩ©Êòé‰∫Æ„ÄÅÂ§ßÂ≠óÈ´îÔºàLarge FontsÔºâ„ÄÇ
    * **ÊéíÁâà**ÔºöÊé°Áî® "Bento Grid" (‰æøÁï∂ÁõíÂºè‰ΩàÂ±Ä) Êàñ "Glassmorphism" (ÊØõÁéªÁíÉÁâπÊïà)„ÄÇ
    * **ÂéüÂâá**ÔºöShow, don't tellÔºàÁî®Â§ßÂúñÁ§∫ËàáÊ∏ÖÊô∞ÂãïÁï´‰ª£ÊõøÂÜóÈï∑Ë™™ÊòéÔºâ„ÄÇ
    * **RWD**ÔºöÂøÖÈ†àÂêåÊôÇÂÆåÁæéÊîØÊè¥ÈõªËÖ¶ÔºàÊäïÂΩ±Áî®ÔºâËàáÂπ≥ÊùøÔºàiPad Êìç‰ΩúÁî®Ôºâ„ÄÇ

2.  **üß† Ë™çÁü•ÊîØÊè¥ (Cognitive Support)**
    * **Âç≥ÊôÇÂèçÈ•ã**ÔºöÊ≠£Á¢∫È°ØÁ§∫ ‚úÖ + ÊÑâÊÇÖÈü≥ÊïàÔºõÈåØË™§È°ØÁ§∫ ‚ùå + Ê∫´ÂíåÊèêÁ§∫Èü≥„ÄÇ
    * **ÂÆπÈåØË®≠Ë®à**ÔºöÂøÖÈ†àÊèê‰æõ„ÄåÊí§Èä∑ (Undo)„ÄçÊàñ„ÄåÈáçË©¶„ÄçÊåâÈàï„ÄÇ
    * **Ê≠•È©üÊãÜËß£**ÔºöÂ∞áË§áÈõú‰ªªÂãôÂàÜËß£ÁÇ∫Ê∏ÖÊô∞ÁöÑÂñÆ‰∏ÄÊ≠•È©ü„ÄÇ

3.  **üåç ÁîüÊ¥ªÈÄ£Áµê (Real-life Context)**
    * ÊÉÖÂ¢ÉË®≠ÂÆöÈúÄË≤ºËøëÂ≠∏ÁîüÁîüÊ¥ªÔºàÂ¶ÇÔºö${formData.context || "Êó•Â∏∏ÁîüÊ¥ª"}Ôºâ„ÄÇ
    * ÂÑ™ÂÖàÈÄ£ÁµêÁç®Á´ãÁîüÊ¥ªÊäÄËÉΩÔºàSocial & Life SkillsÔºâ„ÄÇ

4.  **‚ù§Ô∏è ÊÉÖÁ∑íÊîØÊåÅ (Emotional Support)**
    * **ÊàêÈï∑ÂûãÊÄùÁ∂≠**ÔºöÈåØË™§ÊôÇ**Áµï‰∏çË≤¨ÂÇô**ÔºàÈ°ØÁ§∫Ôºö„ÄåÂÜçË©¶‰∏ÄÊ¨°ÔºÅ„Äç„ÄÅ„ÄåÂ∑Æ‰∏ÄÈªûÈªûÔºÅ„ÄçÔºâ„ÄÇ
    * **Ê≠£ÂêëÂ¢ûÂº∑**Ôºö‰ªªÂãôÂÆåÊàêÊôÇÔºåÁµ¶‰∫àÂº∑ÁÉàË¶ñË¶∫ÂõûÈ•ãÔºàÂ¶ÇÊòüÊòüÈ£õÂá∫„ÄÅÊéåËÅ≤Ôºâ„ÄÇ

5.  **üõ°Ô∏è ÂÆâÂÖ®ËàáÂÉπÂÄºËßÄ (Safety & Values)**
    * **ÂÉπÂÄºËßÄÊª≤ÈÄè**ÔºöÂú®ÂõûÈ•ãÊàñ‰ªãÈù¢ËßíËêΩËá™ÁÑ∂ËûçÂÖ•„Äå${valuesStr}„ÄçÁöÑÊ¶ÇÂøµ„ÄÇ
`;

                if (isGame) {
                    prompt += `
# 4. Êô∫ËÉΩÊïôÂ≠∏ÈÇèËºØ (AI Scaffolding Logic)
**Á®ãÂºèÈúÄÂÖßÂª∫‰ª•‰∏ã‰∏âÈöéÂõûÊáâÊ©üÂà∂ÔºåÊ†πÊìöÂ≠∏ÁîüË°®ÁèæÂãïÊÖãË™øÊï¥Ôºö**

* **üü¢ ÂàùÈöé (Level 1: Visual)**Ôºö‰∏ÄÂè•Ë©±Áõ¥ÁêÉÁ≠îÊ°à + Ê†∏ÂøÉ Emoji/ÂúñÁâá„ÄÇÔºàÈÅ©Áî®ÔºöÂâõÈñãÂßãÊàñ‰∏≠Â∫¶ÊîØÊè¥ÈúÄÊ±ÇÔºâ
* **üü° ÈÄ≤Èöé (Level 2: Logic)**ÔºöÁ∞°Áü≠Ëß£ÈáãÂõ†ÊûúÈóú‰øÇÔºàÂÖ©Âè•Ë©±ÂÖßÔºâ„ÄÇÔºàÈÅ©Áî®ÔºöÂ∑≤ÊéåÊè°ÂêçË©ûÔºâ
* **üî¥ È´òÈöé (Level 3: Metacognition)**ÔºöËß£Èáã + ÂºïÂ∞éÂèçÂïèÔºà‰æãÂ¶ÇÔºö„Äå‰Ω†ÂèØ‰ª•ÂïèÊàë...„ÄçÔºâ„ÄÇÔºàÈÅ©Áî®ÔºöË°®ÁèæÂÑ™Áï∞ËÄÖÔºâ

# 5. ÈÅäÊà≤ÂåñÁµêÁÆóÁ≥ªÁµ± (Game Over & Report)
Áï∂Ê¥ªÂãïÁµêÊùüÊôÇÔºåÈ°ØÁ§∫„ÄåÂÄãÂà•ÂåñÂ†±Âëä„ÄçÁï´Èù¢Ôºö

1.  **Ë°®ÁèæÂàÜÊûê**ÔºöÈ°ØÁ§∫Á∏ΩÂàÜÔºåÈåØË™§ÂàóË°®ÔºåÂ∏∏ÁäØÈåØË™§ÔºåÂ∑≤ÊéåÊè°ÁöÑÁü•Ë≠òÔºåÁµ¶‰∫à‰∏Ä‰∫õÂª∫Ë≠∞ÔºàË™ûÊ∞£Ê∫´ÂíåÔºâ„ÄÇ
2.  **ÈÅ©ÊÄßÂåñÂª∫Ë≠∞ (Adaptive Recommendation)**Ôºö
    * *ÈåØË™§Áéá > 40%*ÔºöÂª∫Ë≠∞„ÄåÂ§öÁ∑¥ÁøíÂàùÈöéÔºåÂä†Ê≤πÔºå‰Ω†ÂèØ‰ª•ÁöÑ„Äç„ÄÇ
    * *ÈåØË™§Áéá 10-40%*ÔºöÂª∫Ë≠∞„ÄåÂÅöÂæóÂæàÂ•ΩÔºåÁπºÁ∫åÁ©©Âõ∫Áü•Ë≠ò„Äç„ÄÇ
    * *ÈåØË™§Áéá < 10%*ÔºöÂª∫Ë≠∞„Äå‰Ω†ÊòØÂ∞àÂÆ∂‰∫ÜÔºÅÊåëÊà∞‰∏ã‰∏ÄÈöéÂêßÔºÅ„Äç„ÄÇ
3.  **Â∞éËà™**ÔºöÂøÖÈ†àÂåÖÂê´„ÄåÈáçÁé©„ÄçËàá„ÄåËøîÂõû‰∏ªÈÅ∏ÂñÆ„ÄçÊåâÈàï„ÄÇ
`;
                }

                return prompt;
            };

            // 2. Generate Technical Prompt (Step 6 + Execution)
            const generateTechPrompt = () => {
                 // Preference Settings Text
                 const preferenceSettingsText = `* **üõ†Ô∏è ÂÅèÂ•ΩË®≠ÂÆöÊ®°ÁµÑ (Preference Settings)**:
        Á∂≤È†ÅÂè≥‰∏äËßíÊúâ‰∏ÄÂÄãÈö±ËóèÂºèÂÅèÂ•ΩË®≠ÂÆöÊ®°ÁµÑÔºåËóçËâ≤Ê≠£ÊñπÂΩ¢ËÉåÊôØ + ÁôΩËâ≤‰∏âÊ¢ùÊ∞¥Âπ≥ÊªëÊ°øÂúñÁ§∫ÔºåÈªûÊìäÊåâÈàïÂæåÔºåÂæûÂè≥ÂÅ¥Êàñ‰∏ãÊñπÊªëÂÖ•/Ê∑°ÂÖ•ÂΩàÂá∫ÈÅ∏ÂñÆ„ÄÇ
        - **ÂäüËÉΩ‰∏Ä**ÔºöÂ≠óÈ´îÂ§ßÂ∞èÔºà6Á¥öÔºâÔºöÂ∞èÂ∞èÁöÑ(14px)ÔΩúÂ∞è‰∏ÄÈªû(16px)ÔΩúÂâõÂâõÂ•Ω(18px)ÔΩúÂ§ß‰∏ÄÈªû(22px)ÔΩúÂ§ßÂ§ßÁöÑ(26px)ÔΩúË∂ÖÔΩûÂ§ß(32px)„ÄÇ
        - **ÂäüËÉΩ‰∫å**ÔºöË™™Ë©±ÈÄüÂ∫¶Ôºà6Á¥öÔºâÔºö0.5ÔΩú0.6ÔΩú0.7ÔΩú0.8ÔΩú0.9ÔΩú1.0ÔºàÂÄçÈÄüÔºâÔºåÊ®ôÈ°åÔºö„ÄåË™™Ë©±ÈÄüÂ∫¶„ÄçÔºåËºîÂä©Ë¶ñË¶∫ÔºöÂ∑¶ÂÅ¥Ê®ôË®ª üê¢„ÄåÊÖ¢ÊÖ¢Ë™™„ÄçÔºåÂè≥ÂÅ¥Ê®ôË®ª üêá„ÄåÂø´Âø´Ë™™„Äç„ÄÇ`;

                let prompt = `# 6. ÊäÄË°ìË¶èÊ†º (Technical Stack)
Ë´ãÁîüÊàê‰∏ÄÂÄãÂÆåÊï¥ÁöÑ**ÂñÆ‰∏Ä HTML Ê™îÊ°à** Ôºå‰∏¶ÂåÖÂê´‰ª•‰∏ãÊäÄË°ìÂØ¶‰ΩúÔºö

1.  **Core Framework**: React (Functional Components + Hooks).
2.  **Styling**: Tailwind CSS (ÈÖçËâ≤ÈúÄÊ¥ªÊΩë„ÄÅÈ´òÂ∞çÊØî„ÄÅË≠∑Áúº).
3.  **Icons**: Lucide-React.
4.  **Animation**: Framer Motion (ÊâÄÊúâÈªûÊìä„ÄÅÂàáÊèõ„ÄÅÂæóÂàÜ„ÄÅÈÄ≤Â†¥ÈÉΩÂøÖÈ†àÊúâÊµÅÊö¢ÂãïÁï´).
5.  **UI Library**: ‰ΩøÁî® shadcn/ui È¢®Ê†ºÁöÑÁµÑ‰ª∂Ë®≠Ë®à.
6.  **ÂøÖÂÇôÂäüËÉΩ**:
    * **üîä Ë™ûÈü≥ÂäüËÉΩ**: Êúâon/offÂäüËÉΩ, Ëã•ÂØ¶‰Ωú \`speak\` ÂáΩÂºèÔºåË´ãÂ∞á \`lang\` È†êË®≠ÂÄºË®≠ÁÇ∫ \`'zh-HK'\`„ÄÇ
    ${formData.includePreferenceSettings ? preferenceSettingsText : ""}
    * **‚¨ÖÔ∏è Â∞éËà™**: Â∑¶‰∏äÊñπÂøÖÈ†àÊúâ‰∏ÄÂÄãÈ°ØÁúºÁöÑ„ÄåËøîÂõû‰∏ªÈ†Å„ÄçÊåâÈàï„ÄÇ
    * **ü¶∂ È†ÅÂ∞æËàáÁâàÊ¨ä (Footer)**: È†ÅÈù¢ÊúÄÂ∫ïÁ´ØÈ°ØÁ§∫ÁΩÆ‰∏≠ÊñáÂ≠óÔºö\`¬©2025 WMC\`„ÄÇ
    * **üè∑Ô∏è Êá∏ÊµÆÊ®ôÁ±§ (FAB)**: 
        - ‰ΩçÁΩÆÔºöÂè≥‰∏ãËßíÂõ∫ÂÆö (Fixed)„ÄÇ
        - Ê®£ÂºèÔºö‰ΩøÁî®ÂΩ©ËôπËà¨ÁöÑÂÖ®ÊÅØËâ≤Ôºàholographic/iridescentÔºâÔºåÈö®Ë¶ñËßíÊàñÊôÇÈñìÂæÆËÆäÔºåÂ§ñÊ°ÜËàáÊñáÂ≠óÔºåÂçäÈÄèÊòéÊùêË≥™ÔºåÁáüÈÄ†Êú™‰æÜÊÑü„ÄÇÂ∏∂ÊúâÈõªËÖ¶ÂûãÂúñÁ§∫„ÄÇ
        - ÂÖßÂÆπÔºö„ÄåWMC ${formData.teacherName || 'TDA'} Ë®≠Ë®à„Äç„ÄÇ

# Âü∑Ë°å‰ªªÂãô (Execution)
Ë´ãÊ†πÊìö‰∏äËø∞ÈÖçÁΩÆÔºåÁ∑®ÂØ´ÂÆåÊï¥ÁöÑÁ®ãÂºèÁ¢º„ÄÇÁ®ãÂºèÁ¢ºÈúÄÂåÖÂê´ÂÆåÊï¥ÁöÑ UI ‰ΩàÂ±Ä„ÄÅÈÇèËºØËôïÁêÜ${formData.category === "ÊïôÂ≠∏ÈÅäÊà≤" ? "„ÄÅ‰ª•Âèä‰∏äËø∞ÁöÑ‰∏âÈöé AI ÂõûÊáâÂÖßÂÆπÊ®°Êì¨" : ""}„ÄÇ`;
                return prompt;
            };

            const handleCopyDesign = () => {
                const text = generateDesignPrompt();
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopiedDesign(true);
                    setTimeout(() => setCopiedDesign(false), 2000);
                } catch (err) {
                    console.error('Unable to copy', err);
                }
                document.body.removeChild(textArea);
            };

            const handleCopyTech = () => {
                const text = generateTechPrompt();
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopiedTech(true);
                    setTimeout(() => setCopiedTech(false), 2000);
                } catch (err) {
                    console.error('Unable to copy', err);
                }
                document.body.removeChild(textArea);
            };

            // Handlers for Save JSON and Export DOCX
            const handleSaveJSON = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(formData, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "tda_data.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const handleExportDOCX = () => {
                const designText = generateDesignPrompt();
                const techText = generateTechPrompt();
                const fullText = designText + "\n\n" + techText;

                if (!window.docx) {
                     alert("DOCX library not loaded. Please try again later.");
                     return;
                }
                const { Document, Packer, Paragraph, TextRun } = window.docx;
                
                const lines = fullText.split('\n');
                const children = lines.map(line => new Paragraph({
                    children: [new TextRun({
                        text: line || " ",
                        font: "Arial"
                    })],
                    spacing: {
                        after: 200,
                    }
                }));

                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: children,
                    }],
                });

                Packer.toBlob(doc).then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    document.body.appendChild(a);
                    a.href = url;
                    a.download = 'tda_prompt.docx';
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }).catch(err => {
                    console.error(err);
                    alert("ÂåØÂá∫ Word Ê™îÊ°àÂ§±Êïó (Export Failed)");
                });
            };
            
            // Handler for Import JSON
            const handleImportJSON = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const json = JSON.parse(e.target.result);
                        // Basic validation could be added here
                        setFormData(json);
                        alert("ÂåØÂÖ•ÊàêÂäüÔºÅ (Import Successful)");
                    } catch (error) {
                        console.error("Error parsing JSON:", error);
                        alert("ÂåØÂÖ•Â§±ÊïóÔºåË´ãÁ¢∫Ë™çÊ™îÊ°àÊ†ºÂºèÊ≠£Á¢∫„ÄÇ (Import Failed)");
                    }
                };
                reader.readAsText(file);
                
                // Clear the input so the same file can be selected again
                event.target.value = ''; 
            };

            // Trigger file input click
            const triggerFileInput = () => {
                fileInputRef.current.click();
            };

            // --- Step Rendering ---

            const renderStep1 = () => (
                <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="col-span-1 md:col-span-2">
                             <Label theme={theme}>1. ÊïôËÅ∑Âì°ÂêçÂ≠ó (Teacher Name)</Label>
                             <Input 
                                 theme={theme}
                                 placeholder="Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂêçÂ≠ó (‰æãÂ¶Ç: Èô≥ËÄÅÂ∏´)" 
                                 value={formData.teacherName}
                                 onChange={(e) => setFormData({...formData, teacherName: e.target.value})}
                             />
                        </div>

                        <div className="col-span-1 md:col-span-2">
                            <Label theme={theme}>2. Â∑•ÂÖ∑ÂêçÁ®± (Tool Name)</Label>
                            <Input 
                                theme={theme}
                                placeholder="‰æãÂ¶ÇÔºöÂø´Ê®ÇËæ≤Â†¥Âä†Ê≥ïÁ∑¥Áøí„ÄÅË™≤Â†ÇÊÉÖÁ∑íÊ∫´Â∫¶Ë®à..." 
                                value={formData.toolName}
                                onChange={(e) => setFormData({...formData, toolName: e.target.value})}
                            />
                        </div>

                        <div>
                            <Label theme={theme}>3. Â∑•ÂÖ∑ÁØÑÁñá (Category)</Label>
                            <div className="grid grid-cols-1 gap-3">
                                {categories.map((cat) => (
                                    <button
                                        key={cat.value}
                                        onClick={() => setFormData({...formData, category: cat.value})}
                                        className={`flex items-center p-3 rounded-xl border transition-all ${
                                            theme === 'cyber'
                                            ? formData.category === cat.value 
                                                ? 'border-cyan-500 bg-cyan-900/30 text-cyan-200 ring-1 ring-cyan-500 shadow-[0_0_10px_rgba(6,182,212,0.3)]' 
                                                : 'border-slate-700 bg-slate-800/50 hover:bg-slate-700/50 text-slate-400'
                                            : formData.category === cat.value
                                                ? 'border-blue-500 bg-blue-50 text-blue-700 ring-1 ring-blue-500'
                                                : 'border-slate-200 bg-white hover:bg-slate-50 text-slate-600'
                                        }`}
                                    >
                                        <cat.icon size={20} className="mr-3" />
                                        <span className="font-medium">{cat.label}</span>
                                    </button>
                                ))}
                            </div>
           
                            {/* Subject Selection - Moved to top level */}
                            <div className="mt-6">
                                <Label theme={theme}>4. ÁßëÁõÆ (Subject)</Label>
                                <Select 
                                    theme={theme}
                                    options={subjects.map(s => ({value: s, label: s}))}
                                    value={formData.subjectCategory}
                                    onChange={(e) => setFormData({...formData, subjectCategory: e.target.value})}
                                />
                                {formData.subjectCategory === "ÂÖ∂‰ªñ" && (
                                    <div className="mt-2">
                                        <Input
                                            theme={theme}
                                            placeholder="Ë´ãËº∏ÂÖ•ÁßëÁõÆÂêçÁ®±..."
                                            value={formData.subjectCustomInput}
                                            onChange={(e) => setFormData({...formData, subjectCustomInput: e.target.value})}
                                            autoFocus
                                        />
                                    </div>
                                )}
                            </div>

                            {/* Game Style Selection - Only for "ÊïôÂ≠∏ÈÅäÊà≤" */}
                            {formData.category === "ÊïôÂ≠∏ÈÅäÊà≤" && (
                                <motion.div 
                                    initial={{ opacity: 0, height: 0 }} 
                                    animate={{ opacity: 1, height: "auto" }}
                                    className="mt-6 space-y-4"
                                >
                                    {/* Game Style */}
                                    <div>
                                        <Label theme={theme}>ÈÅäÊà≤È¢®Ê†º (Game Style) <span className={`text-xs ml-1 font-normal ${theme === 'cyber' ? 'text-cyan-500 orbitron' : 'text-blue-500'}`}>[ÂèØÂ§öÈÅ∏]</span></Label>
                                        <div className="grid grid-cols-2 gap-2">
                                            {gameStyles.map(style => (
                                                <button
                                                    key={style}
                                                    onClick={() => toggleSelection('gameStyle', style)}
                                                    className={`p-2 rounded-lg text-sm font-medium transition-all border text-left ${
                                                        theme === 'cyber'
                                                        ? formData.gameStyle.includes(style)
                                                            ? 'border-pink-500 bg-pink-900/30 text-pink-200 ring-1 ring-pink-500 shadow-[0_0_10px_rgba(236,72,153,0.3)]' 
                                                            : 'border-slate-700 bg-slate-800/50 hover:bg-slate-700/50 text-slate-400'
                                                        : formData.gameStyle.includes(style)
                                                            ? 'border-pink-500 bg-pink-50 text-pink-700 ring-1 ring-pink-500'
                                                            : 'border-slate-200 bg-white hover:bg-slate-50 text-slate-600'
                                                    }`}
                                                >
                                                    {style}
                                                </button>
                                            ))}
                                        </div>
                                        {formData.gameStyle.includes("ÂÖ∂‰ªñ") && (
                                            <div className="mt-2">
                                                <Input
                                                    theme={theme}
                                                    placeholder="Ë´ãËº∏ÂÖ•ÈÅäÊà≤È¢®Ê†º (‰æãÂ¶ÇÔºöÂ∞ÑÊìäÈÅäÊà≤„ÄÅËø∑ÂÆÆ)..."
                                                    value={formData.gameStyleCustomInput}
                                                    onChange={(e) => setFormData({...formData, gameStyleCustomInput: e.target.value})}
                                                    autoFocus
                                                />
                                            </div>
                                        )}
                                    </div>

                                    {/* Example Questions */}
                                    <div>
                                        <Label theme={theme}>ÁØÑ‰æãÈ°åÁõÆ (Example Questions)</Label>
                                        <div className="space-y-3">
                                            {formData.examples.map((ex, index) => (
                                                <div key={index} className="flex gap-2 items-center">
                                                    <div className="flex-1">
                                                        <textarea 
                                                            className={`w-full px-4 py-3 rounded-xl outline-none min-h-[150px] resize-y ${theme === 'cyber' ? 'tech-input' : 'plain-input'}`}
                                                            placeholder={`‰æãÂ¶ÇÔºöËòãÊûúÊòØÁîöÈ∫ºÈ°èËâ≤Ôºü`}
                                                            value={ex.text}
                                                            onChange={(e) => handleExampleChange(index, 'text', e.target.value)}
                                                        />
                                                    </div>
                                                    <div className="w-20">
                                                        <Select 
                                                            theme={theme}
                                                            options={difficultyLevels}
                                                            value={ex.level}
                                                            onChange={(e) => handleExampleChange(index, 'level', e.target.value)}
                                                        />
                                                    </div>
                                                    <div className="w-32">
                                                        <Select 
                                                            theme={theme}
                                                            options={answerMechanismOptions}
                                                            value={ex.mechanism}
                                                            onChange={(e) => handleExampleChange(index, 'mechanism', e.target.value)}
                                                        />
                                                    </div>
                                                    <div className="w-16">
                                                        <Input 
                                                            theme={theme}
                                                            type="number"
                                                            min="1"
                                                            max="100"
                                                            placeholder="Êï∏Èáè"
                                                            value={ex.count}
                                                            onChange={(e) => handleExampleChange(index, 'count', e.target.value)}
                                                        />
                                                    </div>
                                                    <button 
                                                        onClick={() => removeExample(index)}
                                                        className={`p-3 rounded-xl transition-colors border border-transparent ${
                                                            theme === 'cyber'
                                                            ? 'text-red-400 hover:text-red-300 hover:bg-red-900/30 hover:border-red-500/50'
                                                            : 'text-red-500 hover:bg-red-50 hover:border-red-200'
                                                        }`}
                                                        disabled={formData.examples.length === 1}
                                                        title="ÁßªÈô§ÁØÑ‰æã"
                                                    >
                                                        <Trash2 size={20} />
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                        <button 
                                            onClick={addExample}
                                            className={`mt-3 text-sm font-bold flex items-center px-4 py-2 rounded-lg border border-transparent transition-all ${
                                                theme === 'cyber'
                                                ? 'text-cyan-400 hover:text-cyan-200 hover:bg-cyan-900/30 hover:border-cyan-500/50'
                                                : 'text-blue-600 hover:bg-blue-50 hover:border-blue-200'
                                            }`}
                                        >
                                            <Plus size={16} className="mr-1" /> Êñ∞Â¢ûÁØÑ‰æã
                                        </button>
                                    </div>

                                </motion.div>
                            )}
                        </div>

                        <div className="space-y-6">
                            <div>
                                <Label theme={theme}>5. ÁõÆÊ®ôÂπ¥Á¥ö (Target Grade)</Label>
                                <Select 
                                    theme={theme}
                                    options={grades.map(g => ({value: g, label: g}))}
                                    value={formData.grade}
                                    onChange={(e) => setFormData({...formData, grade: e.target.value})}
                                />
                            </div>

                            <div>
                                <Label theme={theme}>6. ÊîØÊè¥ÈúÄÊ±Ç (SEN Support)</Label>
                                <div className="grid grid-cols-1 gap-3">
                                    <button
                                        onClick={() => setFormData({...formData, senLevel: "ËºïÂ∫¶ (Mild)"})}
                                        className={`p-4 rounded-xl border text-left transition-all ${
                                            theme === 'cyber'
                                            ? formData.senLevel === "ËºïÂ∫¶ (Mild)" 
                                                ? 'border-emerald-500 bg-emerald-900/30 text-emerald-200 ring-1 ring-emerald-500' 
                                                : 'border-slate-700 bg-slate-800/50 hover:bg-slate-700/50 text-slate-400'
                                            : formData.senLevel === "ËºïÂ∫¶ (Mild)"
                                                ? 'border-emerald-500 bg-emerald-50 text-emerald-700 ring-1 ring-emerald-500'
                                                : 'border-slate-200 bg-white hover:bg-slate-50 text-slate-600'
                                        }`}
                                    >
                                        <div className={`font-bold tracking-wide ${theme === 'cyber' ? 'orbitron' : ''}`}>ËºïÂ∫¶ÈúÄÊ±Ç (Mild)</div>
                                        <div className="text-xs opacity-70 mt-1">ÈÅ©Âêà‰∏ÄËà¨ÁêÜËß£ÂäõÔºåÂèØÂåÖÂê´ËºÉÂ§öÊñáÂ≠óË™™ÊòéËàáÂºïÂ∞é„ÄÇ</div>
                                    </button>
                                    <button
                                        onClick={() => setFormData({...formData, senLevel: "‰∏≠Â∫¶ (Moderate)"})}
                                        className={`p-4 rounded-xl border text-left transition-all ${
                                            theme === 'cyber'
                                            ? formData.senLevel === "‰∏≠Â∫¶ (Moderate)" 
                                                ? 'border-orange-500 bg-orange-900/30 text-orange-200 ring-1 ring-orange-500' 
                                                : 'border-slate-700 bg-slate-800/50 hover:bg-slate-700/50 text-slate-400'
                                            : formData.senLevel === "‰∏≠Â∫¶ (Moderate)"
                                                ? 'border-orange-500 bg-orange-50 text-orange-700 ring-1 ring-orange-500'
                                                : 'border-slate-200 bg-white hover:bg-slate-50 text-slate-600'
                                        }`}
                                    >
                                        <div className={`font-bold tracking-wide ${theme === 'cyber' ? 'orbitron' : ''}`}>‰∏≠Â∫¶ÈúÄÊ±Ç (Moderate)</div>
                                        <div className="text-xs opacity-70 mt-1">ÈúÄË¶ÅÈ´òÂº∑Â∫¶Ë¶ñË¶∫ËºîÂä©ÔºåÂ∞ëÂ≠óÂ§öÂúñÔºåË©ûÂΩôÁ∞°ÂñÆÁõ¥Êé•„ÄÇ</div>
                                    </button>
                                </div>
                            </div>

                            {/* 7. Learning Diversity Support - New Section */}
                            <div>
                                <Label theme={theme}>7. ÁÖßÈ°ßÂ≠∏ÁøíÂ∑ÆÁï∞ (Learning Diversity) <span className={`text-xs ml-1 font-normal ${theme === 'cyber' ? 'text-cyan-500 orbitron' : 'text-blue-500'}`}>[ÂèØÂ§öÈÅ∏]</span></Label>
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
                                    {learningDiversityOptions.map(opt => (
                                        <button
                                            key={opt.label}
                                            onClick={() => toggleSelection('learningDiversity', opt.label)}
                                            className={`p-3 rounded-lg text-sm font-medium transition-all border text-left flex flex-col gap-1 h-full ${
                                                formData.learningDiversity.includes(opt.label)
                                                ? (theme === 'cyber' 
                                                    ? 'border-cyan-500 bg-cyan-900/30 text-cyan-200 ring-1 ring-cyan-500 shadow-[0_0_10px_rgba(6,182,212,0.3)]'
                                                    : 'border-cyan-500 bg-cyan-50 text-cyan-800 ring-1 ring-cyan-500')
                                                : (theme === 'cyber'
                                                    ? 'border-slate-700 bg-slate-800/50 hover:bg-slate-700/50 text-slate-400'
                                                    : 'border-slate-200 bg-white hover:bg-slate-50 text-slate-600')
                                            }`}
                                        >
                                            <span className="font-bold">{opt.label}</span>
                                            <span className="text-xs opacity-70 font-light">{opt.desc}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* 8. Interaction Mechanism - Renumbered to 8 */}
                        <div className={`col-span-1 md:col-span-2 pt-4 border-t ${theme === 'cyber' ? 'border-slate-800/50' : 'border-slate-200'}`}>
                             <Label theme={theme}>8. ‰∫íÂãïÊ©üÂà∂ (Interaction) <span className={`text-xs ml-1 font-normal ${theme === 'cyber' ? 'text-cyan-500 orbitron' : 'text-blue-500'}`}>[ÂèØÂ§öÈÅ∏]</span></Label>
                             <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
                               {interactionTypes.map(type => (
                                 <button
                                   key={type}
                                   onClick={() => toggleSelection('interactionType', type)}
                                   className={`p-2 rounded-lg text-sm font-medium transition-all border text-left ${
                                     theme === 'cyber'
                                     ? formData.interactionType.includes(type)
                                         ? 'border-violet-500 bg-violet-900/30 text-violet-200 ring-1 ring-violet-500 shadow-[0_0_10px_rgba(139,92,246,0.3)]' 
                                         : 'border-slate-700 bg-slate-800/50 hover:bg-slate-700/50 text-slate-400'
                                     : formData.interactionType.includes(type)
                                         ? 'border-violet-500 bg-violet-50 text-violet-700 ring-1 ring-violet-500'
                                         : 'border-slate-200 bg-white hover:bg-slate-50 text-slate-600'
                                   }`}
                                 >
                                   {type}
                                 </button>
                               ))}
                             </div>
                             {formData.interactionType.includes("ÂÖ∂‰ªñ") && (
                               <div className="mt-2">
                                 <Input
                                   theme={theme}
                                   placeholder="Ë´ãËº∏ÂÖ•‰∫íÂãïÊñπÂºè (‰æãÂ¶ÇÔºöÈÄ£ÈÄ£Áúã„ÄÅÂ°´Á©∫)..."
                                   value={formData.interactionCustomInput}
                                   onChange={(e) => setFormData({...formData, interactionCustomInput: e.target.value})}
                                   autoFocus
                                 />
                               </div>
                             )}
                        </div>
                    </div>
                </motion.div>
            );

            const renderStep2 = () => (
                <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} className="space-y-6">
                    <div>
                        <Label theme={theme}>5. Ê†∏ÂøÉÁî®ÈÄî (Core Purpose)</Label>
                        <div className={`text-xs mb-2 ${theme === 'cyber' ? 'text-slate-400' : 'text-slate-500'}`}>Ë´ãÁ∞°Ëø∞ÈÄôÂÄãÂ∑•ÂÖ∑Ë¶ÅËß£Ê±∫‰ªÄÈ∫ºÂïèÈ°åÔºü</div>
                        <TextArea 
                            theme={theme}
                            placeholder="‰æãÂ¶ÇÔºöËÆìÂ≠∏ÁîüÈÄèÈÅéÊãñÊîæËòãÊûú‰æÜÁ∑¥Áøí 10 ‰ª•ÂÖßÁöÑÂä†Ê≥ïÔºåÊàñÊòØÂπ´Âä©Ëá™ÈñâÁóáÂ≠∏ÁîüÊåáË™çÁï∂‰∏ãÁöÑÊÉÖÁ∑í..." 
                            value={formData.purpose}
                            onChange={(e) => setFormData({...formData, purpose: e.target.value})}
                        />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <Label theme={theme}>6. ÁîüÊ¥ªÊÉÖÂ¢ÉË®≠ÂÆö (Context)</Label>
                            <Input 
                                theme={theme}
                                placeholder="‰æãÂ¶ÇÔºöË∂ÖÁ¥öÂ∏ÇÂ†¥Ë≥ºÁâ©„ÄÅÊê≠‰πòÂú∞Èêµ„ÄÅÁ®ÆÊ§çËä±Êúµ..." 
                                value={formData.context}
                                onChange={(e) => setFormData({...formData, context: e.target.value})}
                            />
                        </div>
                        <div>
                            <Label theme={theme}>7. ËûçÂÖ•ÂÉπÂÄºËßÄ (Values) <span className={`text-xs ml-1 font-normal ${theme === 'cyber' ? 'text-cyan-500 orbitron' : 'text-blue-500'}`}>[ÂèØÂ§öÈÅ∏]</span></Label>
                            <div className="grid grid-cols-2 gap-2 mt-2">
                                {values.map(val => (
                                    <button
                                        key={val}
                                        onClick={() => toggleSelection('value', val)}
                                        className={`p-2 rounded-lg text-sm font-medium transition-all border text-left ${
                                            theme === 'cyber'
                                            ? formData.value.includes(val)
                                                ? 'border-yellow-500 bg-yellow-900/30 text-yellow-200 ring-1 ring-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.3)]' 
                                                : 'border-slate-700 bg-slate-800/50 hover:bg-slate-700/50 text-slate-400'
                                            : formData.value.includes(val)
                                                ? 'border-yellow-500 bg-yellow-50 text-yellow-800 ring-1 ring-yellow-500'
                                                : 'border-slate-200 bg-white hover:bg-slate-50 text-slate-600'
                                        }`}
                                    >
                                        {val}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </motion.div>
            );

            const renderStep3 = () => (
                <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} className="space-y-6">
                    <div>
                        <Label theme={theme}>8. ÂÖ∑È´îË¶èÂâáËàáÈÇèËºØ (Rules)</Label>
                        <div className={`text-xs mb-2 ${theme === 'cyber' ? 'text-slate-400' : 'text-slate-500'}`}>Ë´ãÂàóÂá∫ÈÄôÂÄãÂ∑•ÂÖ∑ÂøÖÈ†àÈÅµÂÆàÁöÑË¶èÂâáÔºà‰æãÂ¶ÇÔºöË®àÂàÜÊñπÂºè„ÄÅÂåØÂÖ•ÂäüËÉΩÁ≠âÔºâ„ÄÇ</div>
                        
                        <div className="space-y-3">
                            {formData.rules.map((rule, index) => (
                                <div key={index} className="flex gap-2">
                                    <div className={`flex-none pt-3 font-bold text-sm w-6 ${theme === 'cyber' ? 'text-cyan-500 orbitron' : 'text-blue-600'}`}>
                                        {index + 1}.
                                    </div>
                                    <TextArea 
                                        theme={theme}
                                        value={rule} 
                                        onChange={(e) => handleRuleChange(index, e.target.value)}
                                        placeholder={`Ë¶èÂâá ${index + 1} (‰æãÂ¶ÇÔºöÁ≠îÈåØÊôÇË¶ÅÊí≠ÊîæÊèêÁ§∫Èü≥)`}
                                        className="min-h-[80px]"
                                    />
                                    <button 
                                        onClick={() => removeRule(index)}
                                        className={`flex-none h-12 mt-1 p-3 rounded-xl transition-colors border border-transparent ${
                                            theme === 'cyber'
                                            ? 'text-red-400 hover:text-red-300 hover:bg-red-900/30 hover:border-red-500/50'
                                            : 'text-red-500 hover:bg-red-50 hover:border-red-200'
                                        }`}
                                        disabled={formData.rules.length === 1}
                                    >
                                        ‚úï
                                    </button>
                                </div>
                            ))}
                        </div>
                        
                        <button 
                            onClick={addRule}
                            className={`mt-3 text-sm font-bold flex items-center px-4 py-2 rounded-lg border border-transparent transition-all ${
                                theme === 'cyber'
                                ? 'text-cyan-400 hover:text-cyan-200 hover:bg-cyan-900/30 hover:border-cyan-500/50'
                                : 'text-blue-600 hover:bg-blue-50 hover:border-blue-200'
                            }`}
                        >
                            + Êñ∞Â¢û‰∏ÄÊ¢ùË¶èÂâá
                        </button>
                    </div>

                    {/* New Technical Features Section */}
                    <div>
                        <Label theme={theme}>ÊäÄË°ìÂäüËÉΩË®≠ÂÆö (Technical Features)</Label>
                        <div className={`p-4 rounded-xl border ${
                            theme === 'cyber' 
                            ? 'border-slate-700 bg-slate-800/30' 
                            : 'border-slate-200 bg-slate-50'
                        }`}>
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className={`p-2 rounded-lg ${
                                        theme === 'cyber' ? 'bg-blue-900/50 text-blue-400' : 'bg-blue-100 text-blue-600'
                                    }`}>
                                        <Accessibility size={20} />
                                    </div>
                                    <div>
                                        <div className={`font-bold text-sm ${theme === 'cyber' ? 'text-slate-200' : 'text-slate-800'}`}>Âä†ÂÖ•ÂÅèÂ•ΩË®≠ÂÆöÊ®°ÁµÑ</div>
                                        <div className={`text-xs ${theme === 'cyber' ? 'text-slate-400' : 'text-slate-500'}`}>ÂåÖÂê´Â≠óÈ´îÂ§ßÂ∞è (6Á¥ö) Ëàá Ë™ûÈü≥ÈÄüÂ∫¶ (6Á¥ö) Ë™øÊï¥ÂäüËÉΩ</div>
                                    </div>
                                </div>
                                <button 
                                    onClick={togglePreferenceSettings}
                                    className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ${
                                        formData.includePreferenceSettings 
                                        ? (theme === 'cyber' ? 'bg-cyan-500' : 'bg-blue-600') 
                                        : (theme === 'cyber' ? 'bg-slate-700' : 'bg-slate-300')
                                    }`}
                                >
                                    <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                        formData.includePreferenceSettings ? 'translate-x-6' : 'translate-x-1'
                                    }`} />
                                </button>
                            </div>
                        </div>
                    </div>
                </motion.div>
            );

            const renderStep4 = () => (
                <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className="space-y-4">
                    <div className={`border p-6 rounded-2xl flex items-start gap-4 ${
                        theme === 'cyber'
                        ? 'bg-slate-900/50 border-cyan-500/30 shadow-[0_0_20px_rgba(6,182,212,0.1)]'
                        : 'bg-white border-blue-200 shadow-md'
                    }`}>
                        <div className={`p-3 rounded-full shadow-sm ${
                            theme === 'cyber'
                            ? 'bg-cyan-900/30 text-cyan-400 border border-cyan-500/50'
                            : 'bg-blue-100 text-blue-600'
                        }`}>
                            <Sparkles size={24} />
                        </div>
                        <div>
                            <h3 className={`text-lg font-bold ${
                                theme === 'cyber' ? 'text-cyan-100 orbitron tracking-wide' : 'text-slate-800'
                            }`}>ÊèêË©ûÂ∑≤ÁîüÊàêÔºÅ</h3>
                            <p className={`text-sm mt-1 ${
                                theme === 'cyber' ? 'text-cyan-200/70' : 'text-slate-500'
                            }`}>
                                Ë´ãÈªûÊìä‰∏ãÊñπÊåâÈàïË§áË£ΩÔºåÁÑ∂ÂæåË≤ºÁµ¶ AI„ÄÇ
                            </p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 h-[600px]">
                        {/* Left Side: Design Prompt */}
                        <div className="flex flex-col h-full">
                            <div className={`flex items-center justify-between mb-2 ${theme === 'cyber' ? 'text-cyan-300' : 'text-slate-700'}`}>
                                <span className="text-sm font-bold orbitron">Part 1: Ë®≠Ë®àËàáÈÇèËºØ</span>
                                <button 
                                    onClick={handleCopyDesign}
                                    className={`px-3 py-1 rounded-lg flex items-center gap-2 text-xs font-bold transition-all border shadow-sm ${
                                        theme === 'cyber'
                                        ? 'bg-slate-800/80 hover:bg-slate-700/80 text-cyan-400 backdrop-blur-md border-cyan-500/30 hover:border-cyan-400'
                                        : 'bg-white hover:bg-slate-50 text-slate-700 border-slate-200 hover:border-slate-300'
                                    }`}
                                >
                                    {copiedDesign ? <CheckCircle size={14} className="text-green-500" /> : <Copy size={14} />}
                                    {copiedDesign ? "Â∑≤Ë§áË£Ω" : "Ë§áË£Ω Part 1"}
                                </button>
                            </div>
                            <textarea 
                                readOnly
                                value={generateDesignPrompt()}
                                className={`flex-1 w-full font-mono text-xs p-4 rounded-xl outline-none resize-none leading-relaxed border shadow-inner ${
                                    theme === 'cyber'
                                    ? 'bg-slate-950 text-cyan-300 border-slate-800'
                                    : 'bg-slate-50 text-slate-700 border-slate-200'
                                }`}
                            />
                        </div>

                        {/* Right Side: Technical Prompt */}
                        <div className="flex flex-col h-full">
                            <div className={`flex items-center justify-between mb-2 ${theme === 'cyber' ? 'text-purple-300' : 'text-slate-700'}`}>
                                <span className="text-sm font-bold orbitron">Part 2: ÊäÄË°ìËàáÂü∑Ë°å</span>
                                <button 
                                    onClick={handleCopyTech}
                                    className={`px-3 py-1 rounded-lg flex items-center gap-2 text-xs font-bold transition-all border shadow-sm ${
                                        theme === 'cyber'
                                        ? 'bg-slate-800/80 hover:bg-slate-700/80 text-purple-400 backdrop-blur-md border-purple-500/30 hover:border-purple-400'
                                        : 'bg-white hover:bg-slate-50 text-slate-700 border-slate-200 hover:border-slate-300'
                                    }`}
                                >
                                    {copiedTech ? <CheckCircle size={14} className="text-green-500" /> : <Copy size={14} />}
                                    {copiedTech ? "Â∑≤Ë§áË£Ω" : "Ë§áË£Ω Part 2"}
                                </button>
                            </div>
                            <textarea 
                                readOnly
                                value={generateTechPrompt()}
                                className={`flex-1 w-full font-mono text-xs p-4 rounded-xl outline-none resize-none leading-relaxed border shadow-inner ${
                                    theme === 'cyber'
                                    ? 'bg-slate-950 text-purple-300 border-slate-800'
                                    : 'bg-slate-50 text-slate-700 border-slate-200'
                                }`}
                            />
                        </div>
                    </div>
                    
                    <div className="flex justify-end gap-2 mt-4">
                             <button 
                                onClick={handleSaveJSON}
                                className={`px-3 py-2 rounded-lg flex items-center gap-2 text-sm font-bold transition-all border shadow-sm ${
                                    theme === 'cyber'
                                    ? 'bg-slate-800/80 hover:bg-slate-700/80 text-cyan-400 backdrop-blur-md border-cyan-500/30 hover:border-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.1)]'
                                    : 'bg-white hover:bg-slate-50 text-slate-700 border-slate-200 hover:border-slate-300'
                                }`}
                                title="ÂÑ≤Â≠òÁÇ∫ JSON Ê™îÊ°à"
                            >
                                <FileJson size={16} />
                                <span className="hidden sm:inline">JSON</span>
                            </button>
                            <button 
                                onClick={handleExportDOCX}
                                className={`px-3 py-2 rounded-lg flex items-center gap-2 text-sm font-bold transition-all border shadow-sm ${
                                    theme === 'cyber'
                                    ? 'bg-slate-800/80 hover:bg-slate-700/80 text-cyan-400 backdrop-blur-md border-cyan-500/30 hover:border-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.1)]'
                                    : 'bg-white hover:bg-slate-50 text-slate-700 border-slate-200 hover:border-slate-300'
                                }`}
                                title="ÂåØÂá∫ÁÇ∫ DOCX Ê™îÊ°à"
                            >
                                <FileText size={16} />
                                <span className="hidden sm:inline">DOCX</span>
                            </button>
                            <button 
                                onClick={() => setStep(3)} // Return to step 3
                                className={`px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-bold transition-all border shadow-sm ${
                                    theme === 'cyber'
                                    ? 'bg-slate-800/80 hover:bg-slate-700/80 text-cyan-400 backdrop-blur-md border-cyan-500/30 hover:border-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.1)]'
                                    : 'bg-white hover:bg-slate-50 text-slate-700 border-slate-200 hover:border-slate-300'
                                }`}
                                title="ËøîÂõû‰∏ä‰∏ÄÊ≠• (Step 3)"
                            >
                                <ChevronLeft size={16} />
                                <span className="hidden sm:inline">‰∏ä‰∏ÄÊ≠•</span>
                            </button>
                    </div>
                </motion.div>
            );

            return (
                <div className="min-h-screen p-4 md:p-8 relative z-10 transition-colors duration-500">
                    <div className="max-w-6xl mx-auto pb-20"> {/* Increased width for dual columns */}
                        
                        {/* Header */}
                        <header className="mb-8 text-center md:text-left flex flex-col md:flex-row md:items-start justify-between gap-4 relative">
                            <div>
                                <h1 className="text-2xl md:text-3xl font-black flex items-start gap-3 justify-center md:justify-start">
                                    <span className={`text-4xl ${theme === 'cyber' ? 'filter drop-shadow-[0_0_10px_rgba(6,182,212,0.8)]' : ''}`}>ü§ñ</span>
                                    <div className="flex flex-col">
                                        <span className={`font-black tracking-wide text-xl md:text-2xl ${
                                            theme === 'cyber' 
                                            ? 'bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 via-blue-400 to-purple-400 drop-shadow-sm text-glow-cyan'
                                            : 'text-slate-900'
                                        }`}>
                                            WMC TDA ÊïôÂ≠∏Ë®≠Ë®àËºîÂä©Â∑•ÂÖ∑ÊèêË©ûÂô®
                                        </span>
                                        <span className={`tracking-wider text-lg md:text-xl font-bold mt-1 ${
                                            theme === 'cyber'
                                            ? "font-['Orbitron'] bg-clip-text text-transparent bg-gradient-to-r from-purple-400 via-pink-400 to-red-400 drop-shadow-sm"
                                            : 'text-slate-600'
                                        }`}>
                                            Teaching Design Aids Prompt Builder
                                        </span>
                                    </div>
                                </h1>
                                <p className={`mt-3 font-medium pl-0 md:pl-[3.5rem] flex items-center gap-2 ${
                                    theme === 'cyber' ? 'text-slate-400' : 'text-slate-500'
                                }`}>
                                    <Zap size={16} className="text-yellow-400" />
                                    3 ÂàÜÈêòË®≠Ë®àÂ∞àÂ±¨ÊïôÊùêÔºöËº∏ÂÖ•ÈúÄÊ±ÇÔºåËá™ÂãïÁîüÊàêÂ∑•Á®ãÂ∏´Á¥öÁöÑÈñãÁôºÊåá‰ª§„ÄÇ
                                </p>
                            </div>
                            <div className="flex flex-col items-end gap-2">
                                <button 
                                    onClick={toggleTheme}
                                    className={`p-2 rounded-full transition-all duration-300 ${
                                        theme === 'cyber' 
                                        ? 'bg-slate-800 text-yellow-400 hover:bg-slate-700 border border-slate-700' 
                                        : 'bg-white text-slate-600 hover:bg-slate-100 border border-slate-200 shadow-sm'
                                    }`}
                                    title={theme === 'cyber' ? "ÂàáÊèõËá≥Á∞°ÊΩîÊ®°Âºè" : "ÂàáÊèõËá≥ÁßëÊäÄÊ®°Âºè"}
                                >
                                    {theme === 'cyber' ? <Sun size={20} /> : <Moon size={20} />}
                                </button>
                                <div className={`hidden md:flex px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 tracking-wider ${
                                    theme === 'cyber'
                                    ? 'border border-cyan-500/50 bg-cyan-950/30 text-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.2)] orbitron'
                                    : 'bg-slate-100 text-slate-600 border border-slate-200'
                                }`}>
                                    <Bot size={16} />
                                    v1.0
                                </div>
                                <button 
                                    onClick={triggerFileInput}
                                    className={`px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 tracking-wider transition-all ${
                                        theme === 'cyber'
                                        ? 'border border-emerald-500/50 bg-emerald-950/30 text-emerald-400 hover:bg-emerald-900/50 shadow-[0_0_10px_rgba(16,185,129,0.2)] orbitron'
                                        : 'bg-emerald-100 text-emerald-700 border border-emerald-200 hover:bg-emerald-200'
                                    }`}
                                    title="ÂåØÂÖ• JSON Ë®≠ÂÆöÊ™î"
                                >
                                    <Upload size={16} />
                                    ÂåØÂÖ• JSON
                                </button>
                                {/* Hidden File Input */}
                                <input 
                                    type="file" 
                                    ref={fileInputRef} 
                                    onChange={handleImportJSON} 
                                    accept=".json" 
                                    className="hidden" 
                                />
                            </div>
                        </header>

                        {/* Progress Bar */}
                        <div className="mb-8 max-w-3xl mx-auto">
                            <div className={`flex justify-between text-xs font-bold mb-2 uppercase tracking-wider ${theme === 'cyber' ? 'orbitron text-slate-500' : 'text-slate-400'}`}>
                                <span className={step >= 1 ? (theme === 'cyber' ? "text-cyan-400 text-glow-cyan" : "text-blue-600") : ""}>Âü∫Êú¨Ë≥áÊñô</span>
                                <span className={step >= 2 ? (theme === 'cyber' ? "text-cyan-400 text-glow-cyan" : "text-blue-600") : ""}>ÂÖßÂÆπÊÉÖÂ¢É</span>
                                <span className={step >= 3 ? (theme === 'cyber' ? "text-cyan-400 text-glow-cyan" : "text-blue-600") : ""}>Ë¶èÂâáË®≠ÂÆö</span>
                                <span className={step >= 4 ? (theme === 'cyber' ? "text-cyan-400 text-glow-cyan" : "text-blue-600") : ""}>ÂÆåÊàêÁîüÊàê</span>
                            </div>
                            <div className={`h-2 rounded-full overflow-hidden ${theme === 'cyber' ? 'bg-slate-800 border border-slate-700/50' : 'bg-slate-200'}`}>
                                <motion.div 
                                    className={`h-full ${
                                        theme === 'cyber' 
                                        ? 'bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-500 shadow-[0_0_10px_rgba(6,182,212,0.5)]'
                                        : 'bg-blue-600'
                                    }`}
                                    initial={{ width: "0%" }}
                                    animate={{ width: `${(step / 4) * 100}%` }}
                                    transition={{ duration: 0.3 }}
                                />
                            </div>
                        </div>

                        {/* Wizard Card - Adjust width for steps */}
                        {step < 4 && (
                            <Card theme={theme} className="min-h-[500px] flex flex-col max-w-3xl mx-auto">
                                <div className="p-6 md:p-8 flex-1">
                                    <AnimatePresence mode="wait">
                                        {step === 1 && renderStep1()}
                                        {step === 2 && renderStep2()}
                                        {step === 3 && renderStep3()}
                                    </AnimatePresence>
                                </div>

                                {/* Footer Controls */}
                                <div className={`p-6 flex justify-between items-center backdrop-blur-sm border-t ${
                                    theme === 'cyber' ? 'bg-slate-900/50 border-slate-800' : 'bg-slate-50 border-slate-100'
                                }`}>
                                    {/* Left Side: Previous Button */}
                                    <div className="w-1/3 flex justify-start">
                                        {step > 1 && (
                                            <button 
                                                onClick={() => setStep(step - 1)}
                                                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition-all ${
                                                    theme === 'cyber'
                                                    ? 'text-slate-400 hover:text-white hover:bg-slate-800'
                                                    : 'text-slate-600 hover:bg-white hover:shadow-sm border border-transparent hover:border-slate-200'
                                                }`}
                                            >
                                                <ChevronLeft size={20} />
                                                ‰∏ä‰∏ÄÊ≠•
                                            </button>
                                        )}
                                    </div>

                                    {/* Center: Spacer */}
                                    <div className="w-1/3 flex justify-center">
                                    </div>

                                    {/* Right Side: Next Button */}
                                    <div className="w-1/3 flex justify-end">
                                        <button 
                                            onClick={() => setStep(step + 1)}
                                            className={`flex items-center gap-2 px-8 py-3 rounded-xl font-bold transition-all hover:scale-105 active:scale-95 group text-white ${
                                                theme === 'cyber'
                                                ? 'bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 shadow-[0_0_20px_rgba(6,182,212,0.4)]'
                                                : 'bg-blue-600 hover:bg-blue-700 shadow-md'
                                            }`}
                                        >
                                            ‰∏ã‰∏ÄÊ≠•
                                            <ChevronRight size={20} className="group-hover:translate-x-1 transition-transform" />
                                        </button>
                                    </div>
                                </div>
                            </Card>
                        )}
                        
                        {/* Step 4 Rendering (Wide Layout) */}
                        {step === 4 && renderStep4()}


                        {/* Extra Links Above Footer */}
                        <div className="mt-12 flex flex-wrap justify-center gap-4">
                            {/* Base44 Link */}
                            <a href="https://base44.com/" target="_blank" rel="noopener noreferrer" className={`px-4 py-2 rounded-lg border transition-all text-sm font-medium flex items-center gap-2 ${
                                theme === 'cyber'
                                ? 'border-cyan-500/30 bg-cyan-900/20 text-cyan-300 hover:bg-cyan-500/20 hover:text-cyan-100'
                                : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-blue-600 shadow-sm'
                            }`}>
                                Base44 <ExternalLink size={14} />
                            </a>
                            
                            {/* Emergent Link */}
                            <a href="https://app.emergent.sh/home" target="_blank" rel="noopener noreferrer" className={`px-4 py-2 rounded-lg border transition-all text-sm font-medium flex items-center gap-2 ${
                                theme === 'cyber'
                                ? 'border-purple-500/30 bg-purple-900/20 text-purple-300 hover:bg-purple-500/20 hover:text-purple-100'
                                : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-purple-600 shadow-sm'
                            }`}>
                                Emergent <ExternalLink size={14} />
                            </a>
                            
                            {/* v0.app Link */}
                            <a href="https://v0.app/" target="_blank" rel="noopener noreferrer" className={`px-4 py-2 rounded-lg border transition-all text-sm font-medium flex items-center gap-2 ${
                                theme === 'cyber'
                                ? 'border-slate-500/30 bg-slate-800/20 text-slate-300 hover:bg-slate-700/40 hover:text-slate-100'
                                : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 shadow-sm'
                            }`}>
                                v0.app <ExternalLink size={14} />
                            </a>
                            
                            {/* Gemini Link */}
                            <a href="https://gemini.google.com/gem/brainstormer" target="_blank" rel="noopener noreferrer" className={`px-4 py-2 rounded-lg border transition-all text-sm font-medium flex items-center gap-2 ${
                                theme === 'cyber'
                                ? 'border-blue-500/30 bg-blue-900/20 text-blue-300 hover:bg-blue-500/20 hover:text-blue-100'
                                : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-blue-600 shadow-sm'
                            }`}>
                                Gemini <ExternalLink size={14} />
                            </a>

                            {/* Lovable Link */}
                            <a href="https://lovable.dev/" target="_blank" rel="noopener noreferrer" className={`px-4 py-2 rounded-lg border transition-all text-sm font-medium flex items-center gap-2 ${
                                theme === 'cyber'
                                ? 'border-pink-500/30 bg-pink-900/20 text-pink-300 hover:bg-pink-500/20 hover:text-pink-100'
                                : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-pink-600 shadow-sm'
                            }`}>
                                Lovable (‰∏çËÉΩÂàÜ‰∫´) <ExternalLink size={14} />
                            </a>

                            {/* GitHub Link */}
                            <a href="https://github.com/" target="_blank" rel="noopener noreferrer" className={`px-4 py-2 rounded-lg border transition-all text-sm font-medium flex items-center gap-2 ${
                                theme === 'cyber'
                                ? 'border-zinc-500/30 bg-zinc-900/20 text-zinc-300 hover:bg-zinc-500/20 hover:text-zinc-100'
                                : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-black shadow-sm'
                            }`}>
                                GitHub <Github size={14} />
                            </a>
                        </div>

                        {/* Footer */}
                        <footer className={`mt-6 py-6 text-center text-xs font-medium tracking-widest ${
                            theme === 'cyber' ? 'text-slate-600 orbitron' : 'text-slate-400'
                        }`}>
                            ¬© 2025 WMC designed by Ken Cheng | Created with Gemini Script & Tailwind CSS
                        </footer>

                        {/* Floating Action Button (FAB) */}
                        <div className="fixed bottom-6 right-6 z-50">
                            <a 
                                href="https://chengky-bot.github.io/kencheng-homepage/" 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className={`flex items-center gap-2 px-4 py-2 rounded-full border backdrop-blur-md transition-all hover:scale-105 group ${
                                theme === 'cyber'
                                ? 'border-white/20 bg-gradient-to-r from-cyan-600/80 via-blue-600/80 to-purple-600/80 animate-holo text-white shadow-[0_0_15px_rgba(6,182,212,0.5)] hover:shadow-[0_0_25px_rgba(6,182,212,0.8)]'
                                : 'bg-white border-slate-200 text-slate-700 shadow-lg hover:shadow-xl'
                            }`}>
                                <Monitor size={20} className={theme === 'cyber' ? "group-hover:animate-pulse" : ""} />
                                <span className="font-bold text-sm tracking-wide text-shadow-sm">Ken ChengË®≠Ë®à</span>
                                <img src="https://i.imgur.com/OQwyeIV.png" alt="Ken Cheng Signature" className="h-6 w-auto ml-1" />
                            </a>
                        </div>

                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
