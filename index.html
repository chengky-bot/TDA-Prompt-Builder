<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMC TDA ÊïôÂ≠∏Ë®≠Ë®àËºîÂä©Â∑•ÂÖ∑ÊèêË©ûÂô®</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX (Pinned version to fix .targets["esmodules"] error) -->
    <script src="https://unpkg.com/@babel/standalone@7.23.6/babel.min.js"></script>
    
    <!-- DOCX Library -->
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Orbitron:wght@400;500;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* --- Cyber Theme Styles --- */
        body.theme-cyber {
            background-color: #020617; /* Slate 950 */
            color: #e2e8f0; /* Slate 200 */
        }

        .cyber-grid {
            position: fixed; top: 0; left: 0; width: 200vw; height: 200vh;
            background-image: linear-gradient(rgba(6, 182, 212, 0.1) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(6, 182, 212, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
            animation: grid-move 20s linear infinite;
            z-index: -1; pointer-events: none; opacity: 0; transition: opacity 0.5s ease;
        }
        
        body.theme-cyber .cyber-grid { opacity: 1; }

        @keyframes grid-move {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); }
        }

        .tech-border {
            background: rgba(15, 23, 42, 0.6); 
            border: 1px solid rgba(6, 182, 212, 0.3); 
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.1);
            backdrop-filter: blur(10px);
        }

        .tech-input {
            background: rgba(30, 41, 59, 0.5); 
            border: 1px solid #334155;
            color: #ecfeff;
        }
        .tech-input:focus {
            border-color: #06b6d4;
            box-shadow: 0 0 8px rgba(6, 182, 212, 0.4);
            outline: none;
        }

        /* --- Plain Theme Styles --- */
        body.theme-plain {
            background-color: #f8fafc; /* Slate 50 */
            color: #1e293b; /* Slate 800 */
        }

        .plain-border {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .plain-input {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            color: #334155;
        }
        .plain-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            outline: none;
        }

        .orbitron { font-family: 'Orbitron', sans-serif; }
        .mono { font-family: 'Share Tech Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        body.theme-cyber ::-webkit-scrollbar-track { background: #0f172a; }
        body.theme-cyber ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; border: 1px solid #06b6d4; }
        body.theme-plain ::-webkit-scrollbar-track { background: #f1f5f9; }
        body.theme-plain ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body class="theme-cyber transition-colors duration-500">
    <div class="cyber-grid"></div>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // Import React first to establish the version
        import React, { useState, useEffect, useCallback } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        
        // FIX: Force Framer Motion and Lucide to use the EXACT same React version using ?deps=
        // This prevents "Multiple React Instances" error (Cannot read properties of null reading 'useContext')
        import { motion, AnimatePresence } from 'https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0,react-dom@18.2.0';
        import { 
            BookOpen, Gamepad2, HeartHandshake, MessageCircle, FlaskConical, 
            ChevronRight, ChevronLeft, Copy, CheckCircle, Wand2, Settings2, 
            Sparkles, Save, RotateCcw, Plus, Trash2, Sun, Moon, FileText, 
            Upload, Download, Code, Monitor, Cpu
        } from 'https://esm.sh/lucide-react@0.292.0?deps=react@18.2.0,react-dom@18.2.0';

        // --- Data & Options ---
        const CATEGORIES = [
            { value: "ÊïôÂ≠∏Â∑•ÂÖ∑", label: "üìö ÊïôÂ≠∏Â∑•ÂÖ∑", icon: BookOpen },
            { value: "ÊïôÂ≠∏ÈÅäÊà≤", label: "üéÆ ÊïôÂ≠∏ÈÅäÊà≤", icon: Gamepad2 },
            { value: "ÊÉÖÁ∑íÊîØÊè¥", label: "‚ù§Ô∏è ÊÉÖÁ∑íÊîØÊè¥", icon: HeartHandshake },
            { value: "Ê∫ùÈÄöËºîÂä©", label: "üó£Ô∏è Ê∫ùÈÄöËºîÂä©", icon: MessageCircle },
            { value: "ÂØ¶È©óÊ®°Êì¨", label: "üß™ ÂØ¶È©óÊ®°Êì¨", icon: FlaskConical },
        ];

        const SUBJECTS = ["Ë™ûÊñá", "Êï∏Â≠∏", "Ëã±Êñá", "‰∫∫Êñá", "ÁßëÂ≠∏", "ÁîüÊ¥ªÊäÄËÉΩ", "ÈõªËÖ¶", "Áè≠‰∏ª‰ªªË™≤", "ÂÖ∂‰ªñ"];
        
        const GRADES = [
            "Â∞èÂ≠∏‰∏ÄÂπ¥Á¥ö (P1)", "Â∞èÂ≠∏‰∫åÂπ¥Á¥ö (P2)", "Â∞èÂ≠∏‰∏âÂπ¥Á¥ö (P3)", 
            "Â∞èÂ≠∏ÂõõÂπ¥Á¥ö (P4)", "Â∞èÂ≠∏‰∫îÂπ¥Á¥ö (P5)", "Â∞èÂ≠∏ÂÖ≠Âπ¥Á¥ö (P6)", 
            "‰∏≠Â≠∏‰∏ÄÂπ¥Á¥ö (S1)", "‰∏≠Â≠∏‰∫åÂπ¥Á¥ö (S2)", "‰∏≠Â≠∏‰∏âÂπ¥Á¥ö (S3)", 
            "‰∏≠Â≠∏ÂõõÂπ¥Á¥ö (S4)", "‰∏≠Â≠∏‰∫îÂπ¥Á¥ö (S5)", "‰∏≠Â≠∏ÂÖ≠Âπ¥Á¥ö (S6)"
        ];

        const GAME_STYLES = [
            "Êâ≠ËõãÊ©ü (Gachapon)", "Â§æÂÖ¨‰ªîÊ©ü (Claw Crane)", "Candy Crush (Ê∂àÈô§È°û)",
            "ËÄÅËôéÊ©ü (Slot Machine)", "ËΩâÁõ§ÊäΩÁçé (Spin Wheel)", "Â§ßÂØåÁøÅ (Board Game)",
            "ÊâìÂú∞Èº† (Whack-a-Mole)", "Êé•Ê∞¥Êûú (Catching Fruit)", "RPG ËßíËâ≤ÊâÆÊºî", "ÂÖ∂‰ªñ"
        ];

        const INTERACTION_TYPES = [
            "ÈªûÊìä (Click)", "ÊãñÊãâÁâ©‰ª∂ (Drag & Drop)", "ÈÄ£Á∑öÈ°å (Connect)", 
            "Áï´Â∏ÉÁπ™Âúñ (Canvas)", "ÁøªÂç°Ë®òÊÜ∂ (Memory)", "Â°´Ëâ≤ (Coloring)",
            "ÊªëÊ°øÊéßÂà∂ (Slider)", "Ë™ûÈü≥‰∫íÂãï (Voice)", "ÂÖ∂‰ªñ"
        ];

        const DIVERSITY_OPTIONS = [
            { label: "Á∞°ÂåñÂÖßÂÆπ (Simplify Content)", desc: "Á∞°ÂñÆË©ûÂΩô„ÄÅÁü≠Âè•Ôºå‰∏ÄÊ¨°‰∏ÄÊ¶ÇÂøµ„ÄÇ" },
            { label: "Â§öÊÑüÂÆòËº∏ÂÖ• (Multi-sensory)", desc: "ÁµêÂêàÂúñÁâá„ÄÅËÅ≤Èü≥„ÄÅÂãï‰Ωú„ÄÇ" },
            { label: "Âç≥ÊôÇÂõûÈ•ã (Instant Feedback)", desc: "ÊØèÊ≠•Áµ¶‰∫àËÇØÂÆöËàáÂãïÁï´„ÄÇ" },
            { label: "Ë™ûÈü≥ÊúóËÆÄÈ°åÁõÆ (TTS Question)", desc: "Âª£Êù±Ë©±È°åÁõÆÊúóËÆÄ„ÄÇ" },
            { label: "Ë™ûÈü≥ÊúóËÆÄÁ≠îÊ°à (TTS Answer)", desc: "Âª£Êù±Ë©±Á≠îÊ°àÊúóËÆÄ„ÄÇ" },
            { label: "Ë¶ñË¶∫ÊèêÁ§∫ (Visual Cues)", desc: "ÁÆ≠È†≠„ÄÅÈ´ò‰∫Æ„ÄÅÈñÉÁàçÊèêÁ§∫„ÄÇ" }
        ];

        const VALUES = ["Â†ÖÊØÖ", "Â∞äÈáç‰ªñ‰∫∫", "Ë≤¨‰ªªÊÑü", "ÂúãÊ∞ëË∫´‰ªΩË™çÂêå", "ÊâøÊìîÁ≤æÁ•û", "Ë™†‰ø°", "‰ªÅÊÑõ", "ÂÆàÊ≥ï", "ÂêåÁêÜÂøÉ", "Âã§Âãû"];

        // --- Components ---
        const Card = ({ children, className = "", theme }) => (
            <div className={`rounded-2xl overflow-hidden p-6 ${theme === 'cyber' ? 'tech-border' : 'plain-border'} ${className}`}>
                {children}
            </div>
        );

        const Label = ({ children, theme }) => (
            <label className={`block text-sm font-bold mb-2 flex items-center gap-2 ${theme === 'cyber' ? 'text-cyan-300 tracking-wide uppercase orbitron' : 'text-slate-700'}`}>
                <span className={`w-1 h-4 rounded-sm inline-block ${theme === 'cyber' ? 'bg-cyan-500' : 'bg-blue-600'}`}></span>
                {children}
            </label>
        );

        const Input = ({ theme, className, ...rest }) => (
            <input className={`w-full px-4 py-3 rounded-xl outline-none ${theme === 'cyber' ? 'tech-input' : 'plain-input'} ${className || ""}`} {...rest} />
        );

        const TextArea = ({ theme, className, ...rest }) => (
            <textarea className={`w-full px-4 py-3 rounded-xl outline-none min-h-[120px] ${theme === 'cyber' ? 'tech-input' : 'plain-input'} ${className || ""}`} {...rest} />
        );

        const Select = ({ options, value, onChange, theme }) => (
            <div className="relative">
                <select value={value} onChange={onChange} className={`w-full px-4 py-3 rounded-xl outline-none appearance-none cursor-pointer ${theme === 'cyber' ? 'tech-input' : 'plain-input'}`}>
                    {options.map(opt => <option key={opt} value={opt} className="text-black">{opt}</option>)}
                </select>
                <div className={`absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none ${theme === 'cyber' ? 'text-cyan-500' : 'text-slate-400'}`}>
                    <ChevronRight size={16} className="rotate-90" />
                </div>
            </div>
        );

        // --- Main Application ---
        function App() {
            const [step, setStep] = useState(1);
            const [theme, setTheme] = useState('cyber');
            // Changed copied state to string to track which section is copied
            const [copiedSection, setCopiedSection] = useState(null);
            
            // Initial State
            const [formData, setFormData] = useState({
                teacherName: "",
                toolName: "",
                category: "ÊïôÂ≠∏ÈÅäÊà≤",
                subjectCategory: "Ë™ûÊñá",
                subjectCustom: "",
                gameStyle: "Êâ≠ËõãÊ©ü (Gachapon)",
                gameStyleCustom: "",
                interactions: ["ÈªûÊìä (Click)"],
                interactionCustom: "",
                learningDiversity: [],
                includePreferenceSettings: true,
                isGemini: true,
                examples: [
                    { text: "1+1=?", level: "ÂàùÈöé", count: 10, mechanism: "3ÈÅ∏1Á≠îÊ°à" }
                ],
                grade: "Â∞èÂ≠∏‰∫åÂπ¥Á¥ö (P2)",
                senLevel: "ËºïÂ∫¶ (Mild)",
                purpose: "",
                context: "",
                value: ["Â†ÖÊØÖ"],
                rules: [
                    "Âú®Âè≥‰∏äËßíÂä†‰∏äÂ≠∏ÁøíÂÑÄË°®ÁâàÂäüËÉΩ", 
                    "Á≠îÂ∞çÊôÇÁµ¶‰∫àÊèêÁ§∫Èü≥ÂèäËß£Èáã", 
                    "È¶ñÈ†ÅËº∏ÂÖ•Ê°ÜÔºöË´ãËº∏ÂÖ•ÂêçÂ≠ó"
                ]
            });

            useEffect(() => {
                document.body.className = `theme-${theme}`;
            }, [theme]);

            const updateField = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            const toggleSelection = (field, item) => {
                setFormData(prev => {
                    const current = prev[field];
                    return {
                        ...prev,
                        [field]: current.includes(item) ? current.filter(i => i !== item) : [...current, item]
                    };
                });
            };

            // Rule Management
            const addRule = () => updateField('rules', [...formData.rules, ""]);
            const updateRule = (idx, val) => {
                const newRules = [...formData.rules];
                newRules[idx] = val;
                updateField('rules', newRules);
            };
            const removeRule = (idx) => updateField('rules', formData.rules.filter((_, i) => i !== idx));

            // Logic Generators
            const generateDesignPrompt = useCallback(() => {
                const rulesList = formData.rules.filter(r => r.trim()).map((r, i) => `${i + 1}. ${r}`).join("\n    ");
                const diversityList = formData.learningDiversity.map(d => {
                    const opt = DIVERSITY_OPTIONS.find(o => o.label === d);
                    return `* **${d}**Ôºö${opt ? opt.desc : ""}`;
                }).join("\n    ");
                
                const style = formData.gameStyle === "ÂÖ∂‰ªñ" ? formData.gameStyleCustom : formData.gameStyle;
                const subject = formData.subjectCategory === "ÂÖ∂‰ªñ" ? formData.subjectCustom : formData.subjectCategory;
                
                let prompt = `# 1. ËßíËâ≤Ë®≠ÂÆö (Role)
‰Ω†ÊòØ‰∏Ä‰ΩçÊìÅÊúâ 15 Âπ¥Á∂ìÈ©óÁöÑ„ÄåË≥áÊ∑±ÂâçÁ´ØÂ∑•Á®ãÂ∏´„ÄçËàá„ÄåÊïôËÇ≤ÁßëÊäÄ UX Â∞àÂÆ∂„ÄçÔºåÂ∞àÊ≥®ÊñºÁÇ∫${formData.grade}Ë®≠Ë®àÁõ¥ËßÄ„ÄÅÈ´ò‰∫íÂãïÊÄßÁöÑÁ∂≤È†ÅÂ≠∏ÁøíÂ∑•ÂÖ∑„ÄÇ

# 2. Â∞àÊ°àÂèÉÊï∏ÈÖçÁΩÆ (Configuration)
* **Â∑•ÂÖ∑ÂêçÁ®±**Ôºö${formData.toolName || "[Êú™ÂëΩÂêç]"}
* **Â∑•ÂÖ∑ÁØÑÁñá**Ôºö${formData.category}
* **ÁßëÁõÆ**Ôºö${subject}
* **Ê†∏ÂøÉÁî®ÈÄî**Ôºö${formData.purpose}
* **ÁõÆÊ®ôÂ≠∏Áîü**Ôºö${formData.grade} (SENÊîØÊè¥: ${formData.senLevel})
* **‰∫íÂãïÊ©üÂà∂**Ôºö${formData.interactions.join("„ÄÅ")} ${formData.interactionCustom ? `„ÄÅ${formData.interactionCustom}` : ""}
${formData.category === "ÊïôÂ≠∏ÈÅäÊà≤" ? `* **ÈÅäÊà≤È¢®Ê†º**Ôºö${style} (‰ª•Ê≠§È¢®Ê†ºÁÇ∫Ë¶ñË¶∫Èö±Âñª)\n* **ÈÅäÊà≤Ê©üÂà∂**ÔºöÈÅäÊà≤ËàáÂïèÁ≠î‰∫§ÊõøÂæ™Áí∞„ÄÇ` : ""}
* **ÁÖßÈ°ßÂ≠∏ÁøíÂ∑ÆÁï∞**Ôºö
    ${diversityList || "ÁÑ°ÁâπÊÆäË®≠ÂÆö"}
* **ËûçÂÖ•ÂÉπÂÄºËßÄ**Ôºö${formData.value.join("„ÄÅ")}
* **ÂÖ∑È´îË¶èÂâá**Ôºö
    ${rulesList || "ÁÑ°ÁâπÊÆäË¶èÂâá"}

# 3. Ë®≠Ë®àËàáÊïôËÇ≤ÂéüÂâá
1. **Ë¶ñË¶∫ÂèãÂñÑ**ÔºöÂ§ßÂ≠óÈ´î„ÄÅÈ´òÂ∞çÊØî„ÄÅÂèØÊÑõÂç°ÈÄöÈ¢®Ê†º„ÄÇ
2. **Âç≥ÊôÇÂèçÈ•ã**ÔºöÊ≠£Á¢∫‚úÖ+Èü≥ÊïàÔºåÈåØË™§‚ùå+Ê∫´ÂíåÊèêÁ§∫„ÄÇ
3. **ÊàêÈï∑ÂûãÊÄùÁ∂≠**ÔºöÁµï‰∏çË≤¨ÂÇôÔºåÈºìÂãµÂÜçË©¶‰∏ÄÊ¨°„ÄÇ
4. **ÁÑ°ÈöúÁ§ô**ÔºöÊîØÊè¥ÈçµÁõ§Â∞éËà™ËàáËû¢ÂπïÈñ±ËÆÄÂô®ÂèãÂñÑÁµêÊßã„ÄÇ

# 4. Êô∫ËÉΩÊïôÂ≠∏ÈÇèËºØ
${formData.category === "ÊïôÂ≠∏ÈÅäÊà≤" ? `
* **üü¢ ÂàùÈöé**ÔºöÁõ¥ÁêÉÁ≠îÊ°à + ÂúñÂÉèÊèêÁ§∫„ÄÇ
* **üü° ÈÄ≤Èöé**ÔºöËß£ÈáãÂõ†ÊûúÈóú‰øÇ„ÄÇ
* **üî¥ È´òÈöé**ÔºöÂºïÂ∞éÂèçÂïèÊ©üÂà∂„ÄÇ` : "Ê†πÊìöÂ≠∏ÁîüË°®ÁèæÂãïÊÖãË™øÊï¥ÊèêÁ§∫Â±§Á¥ö„ÄÇ"}

# 5. ÈÅäÊà≤ÂåñÁµêÁÆó
È°ØÁ§∫ÂÄãÂà•ÂåñÂ†±ÂëäÔºöÂæóÂàÜ„ÄÅÈåØË™§ÂàÜÊûê„ÄÅÈÅ©ÊÄßÂåñÂª∫Ë≠∞ÔºàÂ¶Ç‰∏ãÊ¨°ÊåëÊà∞Èõ£Â∫¶Ôºâ„ÄÇ
`;
                return prompt;
            }, [formData]);

            const generateTechPrompt = useCallback(() => {
                return `# 6. ÊäÄË°ìË¶èÊ†º (Technical Stack)
Ë´ãÁîüÊàê‰∏ÄÂÄãÂÆåÊï¥ÁöÑ **ÂñÆ‰∏Ä HTML Ê™îÊ°à**ÔºåÂåÖÂê´Ôºö
1. **Ê°ÜÊû∂**ÔºöReact (Hooks) + Tailwind CSS (CDN)„ÄÇ
2. **ÂúñÁ§∫**ÔºöLucide-React„ÄÇ
3. **ÂãïÁï´**ÔºöFramer Motion (ÊµÅÊö¢ËΩâÂ†¥)„ÄÇ
4. **ÂäüËÉΩË¶ÅÊ±Ç**Ôºö
    * üîä Ë™ûÈü≥ÂäüËÉΩ (zh-HK)„ÄÇ
    * üíæ ÂÑ≤Â≠ò/‰∏ãËºâ HTML ÂäüËÉΩ„ÄÇ
    * üõ†Ô∏è ${formData.includePreferenceSettings ? "ÂÅèÂ•ΩË®≠ÂÆöÊ®°ÁµÑ (Â≠óÈ´îÂ§ßÂ∞è„ÄÅË™ûÈÄüË™øÊï¥)" : "Âü∫Êú¨Ë®≠ÂÆö"}„ÄÇ
    * üì± ÈüøÊáâÂºèË®≠Ë®à (Mobile/Desktop)„ÄÇ
    * üé® ÈÖçËâ≤Ôºö${theme === 'cyber' ? "Ê∑±Ëâ≤ÁßëÊäÄÈ¢®" : "Êòé‰∫ÆÊ¥ªÊΩëÈ¢®"}„ÄÇ

Ë´ãÁ∑®ÂØ´ÂÆåÊï¥ÁöÑÁ®ãÂºèÁ¢ºÔºåÁ¢∫‰øùÊâÄÊúâÈÇèËºØÔºàÂåÖÊã¨ÈÅäÊà≤Âæ™Áí∞„ÄÅË®àÂàÜ„ÄÅÂõûÈ•ãÔºâÈÉΩËÉΩÂú®ÂñÆ‰∏ÄÊ™îÊ°à‰∏≠Áõ¥Êé•ÈÅãË°å„ÄÇ`;
            }, [formData, theme]);

            const generateFullPrompt = () => {
                return generateDesignPrompt() + "\n\n" + generateTechPrompt();
            };

            const handleCopy = (text, section) => {
                navigator.clipboard.writeText(text);
                setCopiedSection(section);
                setTimeout(() => setCopiedSection(null), 2000);
            };

            const handleExportWord = () => {
                if (!window.docx) { alert("DOCX library loading..."); return; }
                const { Document, Packer, Paragraph, TextRun } = window.docx;
                const text = generateFullPrompt();
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: text.split('\n').map(line => new Paragraph({
                            children: [new TextRun({ text: line, font: "Arial" })]
                        }))
                    }]
                });
                Packer.toBlob(doc).then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${formData.toolName || "TDA_Prompt"}.docx`;
                    a.click();
                });
            };

            // Render Steps
            return (
                <div className="min-h-screen p-4 md:p-8 max-w-5xl mx-auto">
                    {/* Header */}
                    <header className="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
                        <div className="flex items-center gap-3">
                            <div className={`p-3 rounded-xl ${theme === 'cyber' ? 'bg-cyan-500/20 text-cyan-400' : 'bg-blue-600 text-white'}`}>
                                <Wand2 size={32} />
                            </div>
                            <div>
                                <h1 className={`text-2xl md:text-3xl font-black tracking-tight ${theme === 'cyber' ? 'text-white' : 'text-slate-800'}`}>
                                    WMC TDA <span className="font-light opacity-60">PROMPT BUILDER</span>
                                </h1>
                                <p className={`text-xs font-mono tracking-widest ${theme === 'cyber' ? 'text-cyan-500' : 'text-slate-500'}`}>ÊïôÂ≠∏Ë®≠Ë®àËºîÂä©Â∑•ÂÖ∑ÊèêË©ûÂô®</p>
                            </div>
                        </div>
                        <button onClick={() => setTheme(t => t === 'cyber' ? 'plain' : 'cyber')} className={`flex items-center gap-2 px-4 py-2 rounded-full transition-all ${theme === 'cyber' ? 'bg-slate-800 text-yellow-400 border border-slate-700' : 'bg-white text-slate-600 shadow-md border border-slate-100'}`}>
                            {theme === 'cyber' ? <Sun size={18}/> : <Moon size={18}/>}
                            <span className="text-xs font-bold">{theme === 'cyber' ? 'CYBER' : 'PLAIN'}</span>
                        </button>
                    </header>

                    {/* Progress */}
                    <div className="mb-8 flex gap-2">
                        {[1, 2, 3, 4].map(i => (
                            <div key={i} className={`h-1 flex-1 rounded-full transition-all duration-500 ${step >= i ? (theme === 'cyber' ? 'bg-cyan-500' : 'bg-blue-600') : (theme === 'cyber' ? 'bg-slate-800' : 'bg-slate-300')}`} />
                        ))}
                    </div>

                    <AnimatePresence mode="wait">
                        <motion.div 
                            key={step}
                            initial={{ opacity: 0, x: 20 }}
                            animate={{ opacity: 1, x: 0 }}
                            exit={{ opacity: 0, x: -20 }}
                            transition={{ duration: 0.3 }}
                        >
                            {/* STEP 1: Basic Info */}
                            {step === 1 && (
                                <Card theme={theme} className="space-y-6">
                                    <h2 className="text-xl font-bold flex items-center gap-2 mb-6"><Settings2 className="text-cyan-500"/> Âü∫Á§éË®≠ÂÆö (Basic Info)</h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <Label theme={theme}>ÊïôËÅ∑Âì°ÂêçÂ≠ó</Label>
                                            <Input theme={theme} value={formData.teacherName} onChange={e => updateField('teacherName', e.target.value)} placeholder="‰æãÂ¶ÇÔºöÈô≥ËÄÅÂ∏´" />
                                        </div>
                                        <div>
                                            <Label theme={theme}>Â∑•ÂÖ∑ÂêçÁ®±</Label>
                                            <Input theme={theme} value={formData.toolName} onChange={e => updateField('toolName', e.target.value)} placeholder="‰æãÂ¶ÇÔºöÂø´Ê®ÇÊï∏Â≠∏Ëæ≤Â†¥" />
                                        </div>
                                    </div>

                                    <div>
                                        <Label theme={theme}>Â∑•ÂÖ∑ÁØÑÁñá</Label>
                                        <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                                            {CATEGORIES.map(cat => (
                                                <button key={cat.value} onClick={() => updateField('category', cat.value)} className={`p-3 rounded-xl border flex flex-col items-center gap-2 transition-all ${formData.category === cat.value ? (theme === 'cyber' ? 'bg-cyan-500/20 border-cyan-500 text-cyan-300' : 'bg-blue-50 border-blue-600 text-blue-800') : (theme === 'cyber' ? 'border-slate-800 hover:bg-slate-800' : 'border-slate-200 hover:bg-slate-50')}`}>
                                                    <cat.icon size={20} />
                                                    <span className="text-xs font-bold">{cat.label}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <Label theme={theme}>ÈÅ©Áî®Âπ¥Á¥ö</Label>
                                            <Select theme={theme} options={GRADES} value={formData.grade} onChange={e => updateField('grade', e.target.value)} />
                                        </div>
                                        <div>
                                            <Label theme={theme}>ÁßëÁõÆ</Label>
                                            <Select theme={theme} options={SUBJECTS} value={formData.subjectCategory} onChange={e => updateField('subjectCategory', e.target.value)} />
                                            {formData.subjectCategory === "ÂÖ∂‰ªñ" && (
                                                <Input theme={theme} className="mt-2" placeholder="Ë´ãËº∏ÂÖ•ÁßëÁõÆ..." value={formData.subjectCustom} onChange={e => updateField('subjectCustom', e.target.value)} />
                                            )}
                                        </div>
                                    </div>
                                </Card>
                            )}

                            {/* STEP 2: Core Purpose & Context */}
                            {step === 2 && (
                                <Card theme={theme} className="space-y-6">
                                    <h2 className="text-xl font-bold flex items-center gap-2 mb-6"><Code className="text-cyan-500"/> ÊïôÂ≠∏Ê†∏ÂøÉ (Core & Context)</h2>
                                    
                                    <div>
                                        <Label theme={theme}>Ê†∏ÂøÉÁî®ÈÄî (ÊïôÂ≠∏ÁõÆÊ®ô)</Label>
                                        <TextArea theme={theme} value={formData.purpose} onChange={e => updateField('purpose', e.target.value)} placeholder="‰æãÂ¶ÇÔºöËÆìÂ≠∏ÁîüÈÄèÈÅéÈÅäÊà≤Á∑¥Áøí 10 ‰ª•ÂÖßÁöÑÂä†Ê≥ïÈÅãÁÆóÔºå‰∏¶ÂüπÈ§äÊï∏ÊÑü..." />
                                    </div>

                                    <div>
                                        <Label theme={theme}>ÁîüÊ¥ªÊÉÖÂ¢ÉË®≠ÂÆö</Label>
                                        <Input theme={theme} value={formData.context} onChange={e => updateField('context', e.target.value)} placeholder="‰æãÂ¶ÇÔºöË∂ÖÁ¥öÂ∏ÇÂ†¥Ë≥ºÁâ©„ÄÅÂ§™Á©∫Êé¢Èö™„ÄÅÊµ∑Â∫ï‰∏ñÁïå..." />
                                    </div>

                                    <div>
                                        <Label theme={theme}>ËûçÂÖ•ÂÉπÂÄºËßÄ (Â§öÈÅ∏)</Label>
                                        <div className="flex flex-wrap gap-2">
                                            {VALUES.map(v => (
                                                <button key={v} onClick={() => toggleSelection('value', v)} className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all border ${formData.value.includes(v) ? (theme === 'cyber' ? 'bg-cyan-600 border-cyan-500 text-white' : 'bg-blue-600 border-blue-600 text-white') : (theme === 'cyber' ? 'border-slate-700 text-slate-400 hover:border-slate-500' : 'border-slate-300 text-slate-600 hover:bg-slate-50')}`}>
                                                    {v}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </Card>
                            )}

                            {/* STEP 3: Interaction & Diversity */}
                            {step === 3 && (
                                <Card theme={theme} className="space-y-6">
                                    <h2 className="text-xl font-bold flex items-center gap-2 mb-6"><Gamepad2 className="text-cyan-500"/> ‰∫íÂãïËàáÂ∑ÆÁï∞Âåñ (Interaction)</h2>
                                    
                                    {formData.category === "ÊïôÂ≠∏ÈÅäÊà≤" && (
                                        <div>
                                            <Label theme={theme}>ÈÅäÊà≤È¢®Ê†º</Label>
                                            <Select theme={theme} options={GAME_STYLES} value={formData.gameStyle} onChange={e => updateField('gameStyle', e.target.value)} />
                                            {formData.gameStyle === "ÂÖ∂‰ªñ" && (
                                                <Input theme={theme} className="mt-2" placeholder="Ë´ãËº∏ÂÖ•ÈÅäÊà≤È¢®Ê†º..." value={formData.gameStyleCustom} onChange={e => updateField('gameStyleCustom', e.target.value)} />
                                            )}
                                        </div>
                                    )}

                                    <div>
                                        <Label theme={theme}>‰∫íÂãïÊ©üÂà∂ (Â§öÈÅ∏)</Label>
                                        <div className="flex flex-wrap gap-2">
                                            {INTERACTION_TYPES.map(type => (
                                                <button key={type} onClick={() => toggleSelection('interactions', type)} className={`px-3 py-1.5 rounded-lg text-sm transition-all border ${formData.interactions.includes(type) ? (theme === 'cyber' ? 'bg-purple-600 border-purple-500 text-white' : 'bg-indigo-600 border-indigo-600 text-white') : (theme === 'cyber' ? 'border-slate-700 hover:border-slate-500' : 'border-slate-300 hover:bg-slate-50')}`}>
                                                    {type}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div>
                                        <Label theme={theme}>Â≠∏ÁøíÂ∑ÆÁï∞ÊîØÊè¥ (SEN Support)</Label>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            {DIVERSITY_OPTIONS.map(opt => (
                                                <button key={opt.label} onClick={() => toggleSelection('learningDiversity', opt.label)} className={`p-3 rounded-xl border text-left transition-all ${formData.learningDiversity.includes(opt.label) ? (theme === 'cyber' ? 'bg-green-900/30 border-green-500' : 'bg-green-50 border-green-600') : (theme === 'cyber' ? 'border-slate-800' : 'border-slate-200')}`}>
                                                    <div className={`font-bold text-sm ${formData.learningDiversity.includes(opt.label) ? (theme === 'cyber' ? 'text-green-400' : 'text-green-700') : ''}`}>{opt.label}</div>
                                                    <div className="text-xs opacity-60 mt-1">{opt.desc}</div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <Label theme={theme}>ÈÄ≤ÈöéË¶èÂâá (Rules)</Label>
                                        {formData.rules.map((rule, idx) => (
                                            <div key={idx} className="flex gap-2 mb-2">
                                                <Input theme={theme} value={rule} onChange={e => updateRule(idx, e.target.value)} placeholder={`Ë¶èÂâá ${idx+1}`} />
                                                <button onClick={() => removeRule(idx)} className="p-2 text-red-400 hover:bg-red-400/10 rounded-lg"><Trash2 size={18}/></button>
                                            </div>
                                        ))}
                                        <button onClick={addRule} className={`text-sm flex items-center gap-1 mt-2 ${theme === 'cyber' ? 'text-cyan-400 hover:text-cyan-300' : 'text-blue-600 hover:text-blue-700'}`}>
                                            <Plus size={16}/> Êñ∞Â¢ûË¶èÂâá
                                        </button>
                                    </div>
                                </Card>
                            )}

                            {/* STEP 4: Generate & Export */}
                            {step === 4 && (
                                <div className="space-y-6">
                                    <div className="flex justify-end gap-2 mb-2">
                                         <button onClick={handleExportWord} className={`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-all ${theme === 'cyber' ? 'bg-slate-700 hover:bg-slate-600' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'}`}>
                                            <Download size={16}/> ‰∏ãËºâ Word (ÂÆåÊï¥)
                                        </button>
                                    </div>
                                    
                                    {/* Part 1 */}
                                    <Card theme={theme} className="flex flex-col">
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className="text-xl font-bold flex items-center gap-2"><Sparkles className="text-yellow-400"/> Part 1: Ë®≠Ë®àËàáÊïôËÇ≤ÂéüÂâá (#1-#5)</h2>
                                            <button 
                                                onClick={() => handleCopy(generateDesignPrompt(), 'part1')} 
                                                className={`px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-2 transition-all ${copiedSection === 'part1' ? 'bg-green-500 text-white' : (theme === 'cyber' ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white')}`}
                                            >
                                                {copiedSection === 'part1' ? <CheckCircle size={14}/> : <Copy size={14}/>} {copiedSection === 'part1' ? 'Â∑≤Ë§áË£Ω' : 'Ë§áË£Ω'}
                                            </button>
                                        </div>
                                        <div className={`p-4 rounded-xl font-mono text-sm whitespace-pre-wrap overflow-y-auto max-h-[300px] ${theme === 'cyber' ? 'bg-black/40 text-cyan-50' : 'bg-slate-50 text-slate-800 border'}`}>
                                            {generateDesignPrompt()}
                                        </div>
                                    </Card>

                                    {/* Part 2 */}
                                    <Card theme={theme} className="flex flex-col">
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className="text-xl font-bold flex items-center gap-2"><Code className="text-purple-400"/> Part 2: ÊäÄË°ìË¶èÊ†º (#6)</h2>
                                            <button 
                                                onClick={() => handleCopy(generateTechPrompt(), 'part2')} 
                                                className={`px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-2 transition-all ${copiedSection === 'part2' ? 'bg-green-500 text-white' : (theme === 'cyber' ? 'bg-purple-600 hover:bg-purple-500 text-white' : 'bg-indigo-600 hover:bg-indigo-700 text-white')}`}
                                            >
                                                {copiedSection === 'part2' ? <CheckCircle size={14}/> : <Copy size={14}/>} {copiedSection === 'part2' ? 'Â∑≤Ë§áË£Ω' : 'Ë§áË£Ω'}
                                            </button>
                                        </div>
                                        <div className={`p-4 rounded-xl font-mono text-sm whitespace-pre-wrap overflow-y-auto max-h-[300px] ${theme === 'cyber' ? 'bg-black/40 text-cyan-50' : 'bg-slate-50 text-slate-800 border'}`}>
                                            {generateTechPrompt()}
                                        </div>
                                    </Card>
                                </div>
                            )}
                        </motion.div>
                    </AnimatePresence>

                    {/* Footer / Navigation */}
                    <div className={`fixed bottom-0 left-0 w-full p-4 border-t backdrop-blur-md z-50 flex justify-between items-center ${theme === 'cyber' ? 'bg-slate-900/80 border-cyan-900/30' : 'bg-white/90 border-slate-200'}`}>
                        <button 
                            onClick={() => setStep(s => Math.max(1, s - 1))}
                            disabled={step === 1}
                            className={`flex items-center gap-2 px-6 py-2 rounded-xl font-bold transition-all ${step === 1 ? 'opacity-0 pointer-events-none' : (theme === 'cyber' ? 'hover:bg-slate-800 text-slate-400' : 'hover:bg-slate-100 text-slate-600')}`}
                        >
                            <ChevronLeft size={20}/> ‰∏ä‰∏ÄÊ≠•
                        </button>
                        
                        <div className="flex gap-2">
                            {[1,2,3,4].map(i => (
                                <div key={i} className={`w-2 h-2 rounded-full transition-all ${step === i ? (theme === 'cyber' ? 'bg-cyan-400 scale-125' : 'bg-blue-600 scale-125') : (theme === 'cyber' ? 'bg-slate-700' : 'bg-slate-300')}`} />
                            ))}
                        </div>

                        {step < 4 ? (
                            <button 
                                onClick={() => setStep(s => s + 1)}
                                className={`flex items-center gap-2 px-8 py-3 rounded-xl font-bold shadow-lg transition-all ${theme === 'cyber' ? 'bg-cyan-600 hover:bg-cyan-500 text-white shadow-cyan-900/20' : 'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200'}`}
                            >
                                ‰∏ã‰∏ÄÊ≠• <ChevronRight size={20}/>
                            </button>
                        ) : (
                            <button 
                                onClick={() => { setStep(1); setFormData({...formData, teacherName: ""}); }}
                                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition-all ${theme === 'cyber' ? 'text-cyan-400 hover:bg-slate-800' : 'text-blue-600 hover:bg-blue-50'}`}
                            >
                                <RotateCcw size={18}/> ÈáçÁΩÆ
                            </button>
                        )}
                    </div>
                    <div className="h-20"></div> {/* Spacer for fixed footer */}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
